<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Debt Tracker ‚Äì Advanced</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #333; color: white; }
    .summary { margin-top: 20px; font-size: 16px; }
    .alert { padding: 10px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 5px; margin: 10px 0; color: #856404; }
    .tools { margin: 10px 0; text-align: center; }
    .tools button, select { margin: 0 5px; padding: 8px 12px; }
    .note-input { width: 100%; height: 50px; font-size: 14px; }
    .priority-urgent { background: #ffe5e5; }
    .priority-medium { background: #fff9cc; }
    .priority-low { background: #e2f7e2; }
    #amortizationModal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999;
    }
    #amortizationModalContent {
      background: white; max-width: 800px; margin: 40px auto; padding: 20px; border-radius: 10px; max-height: 90%; overflow-y: auto;
    }
  </style>
</head>
<body>
<h1>üìä Debt Tracker ‚Äì Advanced</h1>
<div class="tools">
  <select id="strategySelect">
    <option value="snowball">Snowball (Lowest Balance First)</option>
    <option value="avalanche">Avalanche (Highest Interest First)</option>
  </select>
  <button onclick="simulateStrategy()">Simulate Strategy</button>
  <button onclick="whatIfCalculator()">"What If?" Calculator</button>
  <button onclick="recommendPayment()">AI Payment Advisor</button>
  <button onclick="exportPDF()">üìÑ Export PDF</button>
</div>
<table id="debtTable">
  <thead>
    <tr>
      <th>Name</th><th>Limit</th><th>Balance</th><th>Rate %</th><th>Payment</th>
      <th>Months</th><th>CFI</th><th>Interest</th><th>Priority</th><th>Note</th><th>üìÑ</th><th>‚ùå</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<div class="summary" id="summary"></div>
<div id="alertBox"></div>
<div id="amortizationModal">
  <div id="amortizationModalContent">
    <h2>üìÑ Amortization Schedule ‚Äì <span id="amortDebtName"></span></h2>
    <button onclick="closeAmortization()" style="float:right;background:#dc3545;color:white;">‚ùå Close</button>
    <div id="amortizationContent"></div>
  </div>
</div>
<script>
// [unchanged Firebase + core functions above]
function addDebtRow(data = {}) {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input value="${data.name || ''}" /></td>
    <td><input type="number" value="${data.limit || 0}" /></td>
    <td><input type="number" value="${data.balance || 0}" /></td>
    <td><input type="number" value="${data.rate || 0}" /></td>
    <td><input type="number" value="${data.payment || 0}" /></td>
    <td class="months">-</td>
    <td class="cfi">-</td>
    <td class="interest">-</td>
    <td class="priority">-</td>
    <td><textarea class="note-input">${data.note || ''}</textarea></td>
    <td><button onclick="showAmortization(this)">üìÑ</button></td>
    <td><button onclick="this.closest('tr').remove(); calculate()">‚ùå</button></td>
  `;
  table.appendChild(row);
}

function showAmortization(btn) {
  const row = btn.closest("tr");
  const inputs = row.querySelectorAll("input");
  const name = inputs[0].value;
  const balance = parseFloat(inputs[2].value);
  const rate = parseFloat(inputs[3].value);
  const payment = parseFloat(inputs[4].value);

  document.getElementById("amortDebtName").innerText = name;
  const container = document.getElementById("amortizationContent");
  container.innerHTML = "";

  if (!balance || !rate || !payment || payment <= 0) {
    container.innerHTML = "<p style='color:red;'>‚ùå Invalid input values.</p>";
    document.getElementById("amortizationModal").style.display = "block";
    return;
  }

  let html = `<table><thead><tr><th>Month</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Balance</th></tr></thead><tbody>`;
  let r = rate / 100 / 12, m = 0, totalInt = 0, bal = balance;

  while (bal > 0 && m < 1200) {
    const int = bal * r;
    let princ = payment - int;
    if (princ > bal) princ = bal;
    bal -= princ;
    totalInt += int;
    html += `<tr><td>${m + 1}</td><td>$${(princ + int).toFixed(2)}</td><td>$${princ.toFixed(2)}</td><td>$${int.toFixed(2)}</td><td>$${bal.toFixed(2)}</td></tr>`;
    m++;
  }

  html += `</tbody></table><p><strong>Total Interest:</strong> $${totalInt.toFixed(2)}</p>`;
  container.innerHTML = html;
  document.getElementById("amortizationModal").style.display = "block";
}

function closeAmortization() {
  document.getElementById("amortizationModal").style.display = "none";
}
// [rest of original script remains unchanged below this point]
</script>
</body>
</html>
