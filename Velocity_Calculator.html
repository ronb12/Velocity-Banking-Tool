<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Debt Crusher ‚Äì Velocity Banking Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
        }
        form {
            margin-bottom: 20px;
        }
        input, button, select {
            width: calc(100% - 22px);
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007BFF;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .feedback {
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .high {
            background-color: #ffcccc;
            color: #cc0000;
        }
        .normal {
            background-color: #ccffcc;
            color: #006600;
        }
        .strategy {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
    
@media print {
  #user-name-display {
    display: block !important;
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #000;
  }
}
</style>
<style media="print">
form, button { display: none !important; }
.strategy { page-break-after: always; }
table { page-break-inside: avoid; }
body { color-adjust: exact !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
</style><style>
#recommended-strategy {
  background: #e8f5e9;
  border: 2px solid #4caf50;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
}
#recommended-strategy h2 {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.recommendation-badge {
  background: #4CAF50;
  color: white;
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: bold;
  font-size: 14px;
}

/* Header and Navigation Styles */
.header {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  text-align: center;
  position: relative;
}

.back-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #007bff;
  text-decoration: none;
  font-weight: 600;
  padding: 10px 16px;
  border-radius: 8px;
  background: rgba(0, 123, 255, 0.1);
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.back-link:hover {
  background: rgba(0, 123, 255, 0.2);
  transform: translateX(-5px);
}

.header h1 {
  color: #007bff;
  font-size: 2.2rem;
  margin: 10px 0;
  font-weight: 700;
}

/* Dark Mode Support */
body.dark-mode {
  background-color: #1a1a1a;
  color: #e0e0e0;
}

body.dark-mode .container {
  background: #2d2d2d;
  color: #e0e0e0;
}

body.dark-mode .header {
  background: #2d2d2d;
  color: #e0e0e0;
}

body.dark-mode .header h1 {
  color: #4a9eff;
}

body.dark-mode .back-link {
  color: #4a9eff;
  background: rgba(74, 158, 255, 0.1);
}

body.dark-mode .back-link:hover {
  background: rgba(74, 158, 255, 0.2);
}

body.dark-mode input, body.dark-mode select, body.dark-mode textarea {
  background-color: #3d3d3d;
  color: #e0e0e0;
  border-color: #555;
}

body.dark-mode input:focus, body.dark-mode select:focus, body.dark-mode textarea:focus {
  border-color: #4a9eff;
  box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
}

body.dark-mode button {
  background-color: #4a9eff;
  color: white;
}

body.dark-mode button:hover {
  background-color: #357abd;
}

body.dark-mode table {
  background-color: #2d2d2d;
  color: #e0e0e0;
}

body.dark-mode th {
  background-color: #3d3d3d;
  color: #e0e0e0;
}

body.dark-mode tr:hover {
  background-color: #3d3d3d;
}

body.dark-mode .feedback.high {
  background-color: #4a1a1a;
  color: #ff6b6b;
}

body.dark-mode .feedback.normal {
  background-color: #1a4a1a;
  color: #6bff6b;
}

body.dark-mode #recommended-strategy {
  background: #1a2d1a;
  border-color: #4CAF50;
}

body.dark-mode .recommendation-badge {
  background: #4CAF50;
  color: white;
}

/* Help Section Styles */
.help-section {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

/* Modal Styles */
.modal {
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  overflow-y: auto;
}

.modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  position: absolute;
  top: 15px;
  right: 20px;
}

.close:hover {
  color: #000;
}

.help-section h3 {
  color: #007bff;
  margin-top: 20px;
  margin-bottom: 10px;
}

.help-section ul, .help-section ol {
  margin-left: 20px;
  margin-bottom: 15px;
}

.help-section li {
  margin-bottom: 5px;
}

/* Examples Grid */
.examples-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.example-card {
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.example-card:hover {
  border-color: #007bff;
  background: #e3f2fd;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.example-card h3 {
  color: #007bff;
  margin-bottom: 15px;
}

.example-card p {
  margin: 8px 0;
  font-size: 0.9rem;
  color: #666;
}

/* Dark Mode Modal Styles */
body.dark-mode .modal-content {
  background-color: #2d2d2d;
  color: #e0e0e0;
}

body.dark-mode .close {
  color: #aaa;
}

body.dark-mode .close:hover {
  color: #fff;
}

body.dark-mode .example-card {
  background: #3d3d3d;
  border-color: #555;
  color: #e0e0e0;
}

body.dark-mode .example-card:hover {
  border-color: #4a9eff;
  background: #1a2d3d;
}

body.dark-mode .example-card h3 {
  color: #4a9eff;
}

body.dark-mode .example-card p {
  color: #ccc;
}

/* Warning Box Styles */
.warning-box {
  background: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 8px;
  padding: 15px;
  margin: 20px 0;
}

.warning-box h4 {
  color: #856404;
  margin-bottom: 10px;
}

.warning-box p {
  color: #856404;
  margin: 0;
  font-size: 0.9rem;
}

/* Dark Mode Warning Box */
body.dark-mode .warning-box {
  background: #3d2f00;
  border-color: #ffc107;
}

body.dark-mode .warning-box h4 {
  color: #ffc107;
}

body.dark-mode .warning-box p {
  color: #ffc107;
}

/* Help Section Improvements */
.help-section h3 {
  color: #007bff;
  margin-top: 25px;
  margin-bottom: 15px;
  padding-bottom: 5px;
  border-bottom: 2px solid #e9ecef;
}

.help-section h3:first-child {
  margin-top: 0;
}

.help-section ul, .help-section ol {
  margin-left: 20px;
  margin-bottom: 20px;
}

.help-section li {
  margin-bottom: 8px;
  line-height: 1.5;
}

.help-section strong {
  color: #495057;
  font-weight: 600;
}

/* Dark Mode Help Section */
body.dark-mode .help-section h3 {
  color: #4a9eff;
  border-bottom-color: #555;
}

body.dark-mode .help-section strong {
  color: #e0e0e0;
}

/* Suggestion Box Styles */
.suggestion-box {
  background: #e3f2fd;
  border: 2px solid #2196f3;
  border-radius: 8px;
  padding: 15px;
  margin: 10px 0;
}

.suggestion-box h4 {
  color: #1976d2;
  margin-bottom: 10px;
}

.suggestion-box p {
  margin: 5px 0;
  color: #333;
}

/* Dark Mode Suggestion Box */
body.dark-mode .suggestion-box {
  background: #1a2d3d;
  border-color: #4a9eff;
}

body.dark-mode .suggestion-box h4 {
  color: #4a9eff;
}

body.dark-mode .suggestion-box p {
  color: #e0e0e0;
}

</style></head>
<body>
<div class="container">
    <div class="header">
        <a href="index.html" class="back-link">
            ‚Üê Back to Dashboard
        </a>
<h1>Debt Crusher ‚Äì Velocity Banking Tool</h1>
        <div class="help-section">
            <button id="helpToggle" class="btn btn-outline" onclick="toggleHelp()">‚ùì Help & Tutorial</button>
            <button id="examplesToggle" class="btn btn-outline" onclick="toggleExamples()">üìã Examples</button>
        </div>
    </div>
<form id="calculator-form">
<label for="userName">Your Name (optional):</label>
<input id="userName" name="userName" placeholder="Enter your name" type="text"/>
<label for="income">Monthly Income ($)</label>
<input id="income" required="" step="0.01" type="number" title="Enter your monthly income"/>
<label for="extraIncome">Yearly Extra Income ($)</label>
<input id="extraIncome" required="" step="0.01" type="number" title="Enter any additional yearly income"/>
<label for="expenses">Monthly Expenses ($)</label>
<input id="expenses" required="" step="0.01" type="number" title="Enter your monthly expenses"/>
<label for="debtBalance">Total Debt Balance ($)</label>
<input id="debtBalance" required="" step="0.01" type="number" title="Enter your total debt balance"/>
<label for="interestRate">Average Interest Rate (%)</label>
<input id="interestRate" required="" step="0.01" type="number" title="Enter the average interest rate on your debts"/>
<label for="minimumPayment">Minimum Monthly Payment ($)</label>
<input id="minimumPayment" required="" step="0.01" type="number" title="Enter your minimum monthly payment"/>
<label for="extraPayment">Extra Payment ($)</label>
<input id="extraPayment" step="0.01" type="number" title="Enter any extra payment you can make monthly"/>
<label for="lineOfCredit">Select Velocity Banking Line of Credit:</label>
<select id="lineOfCredit" required="" title="Select the type of line of credit you are using">
<option value="creditCard">Credit Card</option>
<option value="HELOC">HELOC</option>
<option value="personalLoan">Personal Loan</option>
<option value="businessLoan">Business Loan</option>
<option value="ploc">PLOC (e.g., NetCredit)</option>
</select>
<label for="chunkPayment">Velocity Banking Chunk Payment ($)</label>
<input id="chunkPayment" required="" step="0.01" type="number" title="Enter the chunk payment amount for velocity banking"/>
<label for="chunkMonths">Months for Chunk Payments (comma-separated, e.g., 3,6,12)</label>
<input id="chunkMonths" placeholder="e.g., 3,6,12" type="text" title="Enter the months for chunk payments, separated by commas"/>
<button type="submit">Calculate</button>
<button id="saveInputs" type="button">Save Inputs</button>
<button id="loadInputs" type="button">Load Inputs</button>
<button id="exportPdf" type="button">Export Strategy as PDF</button>
<button id="exportCsv" type="button">üìä Export to CSV</button>
<label><input id="limitMonthsToggle" style="width:auto; margin-right:10px;" type="checkbox"/> Limit table to first 60 months</label>
</form>
<div id="feedback"></div>
<div id="user-name-display" style="font-size: 18px; font-weight: bold; margin-top: 20px;"></div><div id="results"></div>
<div id="recommended-strategy" style="margin-top: 30px;">
<h2>Recommended Strategy<span class="recommendation-badge">RECOMMENDED</span></h2>
<div id="recommended-strategy-details"></div>
</div>
<div id="loadingIndicator" style="display: none; text-align: center; margin: 20px 0;">
  <p>Loading...</p>
</div>
<div id="pdfLoadingIndicator" style="display: none; text-align: center; margin: 20px 0;">
  <p>Generating PDF...</p>
</div>
<footer style="text-align: center; margin-top: 40px; font-weight: bold; font-size: 14px; color: #555;">This is a product of Bradley Virtual Solutions, LLC</footer></div>

<!-- Help Modal -->
<div id="helpModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="toggleHelp()">&times;</span>
        <h2>üöÄ Velocity Banking Tutorial</h2>
        
        <div class="help-section">
            <h3>What is Velocity Banking?</h3>
            <p>Velocity Banking is a debt payoff strategy that uses a line of credit to accelerate debt elimination. Instead of making small monthly payments, you make large "chunk" payments at strategic intervals.</p>
            
            <h3>How It Works:</h3>
            <ol>
                <li><strong>Get a Line of Credit:</strong> Credit card, HELOC, or personal loan</li>
                <li><strong>Make Chunk Payments:</strong> Use the line of credit to make large payments</li>
                <li><strong>Pay Off Line of Credit:</strong> Use your regular income to pay off the line of credit</li>
                <li><strong>Repeat:</strong> Continue until debt is eliminated</li>
            </ol>
            
            <h3>Key Benefits:</h3>
            <ul>
                <li>‚úÖ Faster debt elimination</li>
                <li>‚úÖ Reduced total interest paid</li>
                <li>‚úÖ Psychological momentum</li>
                <li>‚úÖ Flexible payment timing</li>
            </ul>
            
            <h3>‚ö†Ô∏è Important Risk Warnings:</h3>
            <ul>
                <li><strong>Credit Score Impact:</strong> High credit utilization can lower your score temporarily</li>
                <li><strong>Interest Rate Risks:</strong> Variable rates on lines of credit can increase</li>
                <li><strong>Discipline Required:</strong> Must maintain strict payment schedule or risk financial disaster</li>
                <li><strong>Emergency Fund:</strong> Never use emergency savings for chunk payments</li>
                <li><strong>Job Security:</strong> Requires stable, reliable income source</li>
            </ul>
            
            <h3>‚úÖ Prerequisites & Requirements:</h3>
            <ul>
                <li><strong>Credit Score:</strong> Minimum 680+ for best rates (720+ preferred)</li>
                <li><strong>Income Stability:</strong> Consistent, verifiable income for 2+ years</li>
                <li><strong>Debt-to-Income:</strong> Maximum 43% DTI ratio for approval</li>
                <li><strong>Emergency Fund:</strong> 3-6 months expenses saved first</li>
                <li><strong>Documentation:</strong> Tax returns, pay stubs, bank statements</li>
            </ul>
            
            <h3>üìã Pre-Velocity Checklist:</h3>
            <ol>
                <li>‚úÖ Build emergency fund (3-6 months expenses)</li>
                <li>‚úÖ Improve credit score to 680+</li>
                <li>‚úÖ Calculate all monthly obligations</li>
                <li>‚úÖ Get pre-approved for line of credit</li>
                <li>‚úÖ Create detailed budget and stick to it</li>
                <li>‚úÖ Have backup plan if income changes</li>
            </ol>
            
            <h3>üìÖ Monthly Implementation Workflow:</h3>
            <ol>
                <li><strong>Week 1:</strong> Make minimum payment on debt</li>
                <li><strong>Week 2:</strong> Save money for chunk payment</li>
                <li><strong>Week 3:</strong> Continue saving, monitor progress</li>
                <li><strong>Week 4:</strong> Make chunk payment (if scheduled month)</li>
                <li><strong>Ongoing:</strong> Pay off line of credit monthly</li>
            </ol>
            
            <h3>‚ùå Common Mistakes to Avoid:</h3>
            <ul>
                <li><strong>Overextending Credit:</strong> Don't max out your line of credit</li>
                <li><strong>Missing Payments:</strong> Late payments can destroy your credit</li>
                <li><strong>Poor Timing:</strong> Don't start during job uncertainty or major expenses</li>
                <li><strong>Ignoring Fees:</strong> Watch for annual fees, balance transfer fees</li>
                <li><strong>Not Tracking:</strong> Monitor progress monthly and adjust as needed</li>
                <li><strong>Emotional Decisions:</strong> Stick to the plan, don't deviate</li>
            </ul>
            
            <h3>üéØ Advanced Strategies:</h3>
            <ul>
                <li><strong>Debt Prioritization:</strong> Target highest interest debts first</li>
                <li><strong>Seasonal Bonuses:</strong> Use tax refunds, bonuses for extra chunks</li>
                <li><strong>Scaling Up:</strong> Increase chunk amounts as debt decreases</li>
                <li><strong>Multiple Debts:</strong> Focus on one debt at a time for maximum impact</li>
                <li><strong>Goal Setting:</strong> Set realistic 12-24 month payoff targets</li>
            </ul>
            
            <h3>üì± Recommended Tools & Resources:</h3>
            <ul>
                <li><strong>Budgeting Apps:</strong> YNAB, Mint, or EveryDollar</li>
                <li><strong>Credit Monitoring:</strong> Credit Karma, Experian</li>
                <li><strong>Debt Tracking:</strong> Undebt.it, Debt Payoff Planner</li>
                <li><strong>Education:</strong> Dave Ramsey, The Money Guy Show</li>
                <li><strong>Community:</strong> Reddit r/personalfinance, Facebook groups</li>
            </ul>
            
            <h3>Input Guidelines:</h3>
            <ul>
                <li><strong>Minimum Payment:</strong> Must be at least equal to monthly interest</li>
                <li><strong>Chunk Payment:</strong> Should be 2-3x your monthly payment</li>
                <li><strong>Chunk Months:</strong> Space payments 3-6 months apart</li>
                <li><strong>Line of Credit:</strong> Choose based on your credit profile</li>
            </ul>
            
            <h3>Example Scenario:</h3>
            <p>Debt: $50,000 at 15% APR<br>
            Monthly Payment: $1,500<br>
            Chunk Payment: $3,000 every 3 months<br>
            Result: Pay off 2-3 years faster!</p>
            
            <div class="warning-box">
                <h4>‚ö†Ô∏è Legal Disclaimer:</h4>
                <p>This calculator is for educational purposes only. Always consult with a qualified financial advisor before making major financial decisions. Results are estimates and actual outcomes may vary based on individual circumstances.</p>
            </div>
        </div>
    </div>
</div>

<!-- Examples Modal -->
<div id="examplesModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="toggleExamples()">&times;</span>
        <h2>üìã Example Scenarios</h2>
        
        <div class="examples-grid">
            <div class="example-card" onclick="loadExample('credit-card')">
                <h3>üí≥ Credit Card Debt</h3>
                <p>Debt: $25,000 at 24% APR</p>
                <p>Income: $5,000/month</p>
                <p>Expenses: $3,500/month</p>
                <p>Min Payment: $750</p>
                <p>Chunk: $1,500 every 3 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('student-loan')">
                <h3>üéì Student Loan</h3>
                <p>Debt: $80,000 at 6.8% APR</p>
                <p>Income: $6,000/month</p>
                <p>Expenses: $4,000/month</p>
                <p>Min Payment: $1,200</p>
                <p>Chunk: $2,500 every 4 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('car-loan')">
                <h3>üöó Car Loan</h3>
                <p>Debt: $35,000 at 5.9% APR</p>
                <p>Income: $4,500/month</p>
                <p>Expenses: $3,200/month</p>
                <p>Min Payment: $650</p>
                <p>Chunk: $1,300 every 2 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('personal-loan')">
                <h3>üè¶ Personal Loan</h3>
                <p>Debt: $15,000 at 12% APR</p>
                <p>Income: $3,500/month</p>
                <p>Expenses: $2,800/month</p>
                <p>Min Payment: $400</p>
                <p>Chunk: $800 every 3 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('mortgage')">
                <h3>üè† Mortgage</h3>
                <p>Debt: $300,000 at 7.5% APR</p>
                <p>Income: $8,000/month</p>
                <p>Expenses: $5,500/month</p>
                <p>Min Payment: $2,100</p>
                <p>Chunk: $4,200 every 6 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('business-debt')">
                <h3>üíº Business Debt</h3>
                <p>Debt: $75,000 at 18% APR</p>
                <p>Income: $12,000/month</p>
                <p>Expenses: $8,500/month</p>
                <p>Min Payment: $1,500</p>
                <p>Chunk: $3,000 every 2 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('medical-debt')">
                <h3>üè• Medical Debt</h3>
                <p>Debt: $45,000 at 0% APR</p>
                <p>Income: $4,200/month</p>
                <p>Expenses: $3,100/month</p>
                <p>Min Payment: $500</p>
                <p>Chunk: $1,200 every 4 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('home-equity')">
                <h3>üè° Home Equity Loan</h3>
                <p>Debt: $120,000 at 8.2% APR</p>
                <p>Income: $9,500/month</p>
                <p>Expenses: $6,800/month</p>
                <p>Min Payment: $1,800</p>
                <p>Chunk: $3,600 every 3 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('consolidation')">
                <h3>üîÑ Debt Consolidation</h3>
                <p>Debt: $60,000 at 14% APR</p>
                <p>Income: $6,500/month</p>
                <p>Expenses: $4,200/month</p>
                <p>Min Payment: $1,200</p>
                <p>Chunk: $2,400 every 3 months</p>
            </div>
            
            <div class="example-card" onclick="loadExample('high-income')">
                <h3>üí∞ High Income Scenario</h3>
                <p>Debt: $200,000 at 6% APR</p>
                <p>Income: $25,000/month</p>
                <p>Expenses: $15,000/month</p>
                <p>Min Payment: $2,500</p>
                <p>Chunk: $8,000 every 2 months</p>
            </div>
        </div>
    </div>
</div>
<script>
        // Check for global dark mode setting and apply it
        function applyDarkMode() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // Format currency with proper comma separators
        function formatCurrency(amount) {
            return `$${parseFloat(amount).toLocaleString('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })}`;
        }

        // Modal functions
        function toggleHelp() {
            const modal = document.getElementById('helpModal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        }

        function toggleExamples() {
            const modal = document.getElementById('examplesModal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const helpModal = document.getElementById('helpModal');
            const examplesModal = document.getElementById('examplesModal');
            if (event.target === helpModal) {
                helpModal.style.display = 'none';
            }
            if (event.target === examplesModal) {
                examplesModal.style.display = 'none';
            }
        }

        // Example scenarios data
        const examples = {
            'credit-card': {
                income: 5000,
                extraIncome: 0,
                expenses: 3500,
                debtBalance: 25000,
                interestRate: 24,
                minimumPayment: 750,
                extraPayment: 0,
                lineOfCredit: 'creditCard',
                chunkPayment: 1500,
                chunkMonths: '3,6,9,12'
            },
            'student-loan': {
                income: 6000,
                extraIncome: 0,
                expenses: 4000,
                debtBalance: 80000,
                interestRate: 6.8,
                minimumPayment: 1200,
                extraPayment: 0,
                lineOfCredit: 'personalLoan',
                chunkPayment: 2500,
                chunkMonths: '4,8,12,16'
            },
            'car-loan': {
                income: 4500,
                extraIncome: 0,
                expenses: 3200,
                debtBalance: 35000,
                interestRate: 5.9,
                minimumPayment: 650,
                extraPayment: 0,
                lineOfCredit: 'personalLoan',
                chunkPayment: 1300,
                chunkMonths: '2,4,6,8'
            },
            'personal-loan': {
                income: 3500,
                extraIncome: 0,
                expenses: 2800,
                debtBalance: 15000,
                interestRate: 12,
                minimumPayment: 400,
                extraPayment: 0,
                lineOfCredit: 'creditCard',
                chunkPayment: 800,
                chunkMonths: '3,6,9'
            },
            'mortgage': {
                income: 8000,
                extraIncome: 0,
                expenses: 5500,
                debtBalance: 300000,
                interestRate: 7.5,
                minimumPayment: 2100,
                extraPayment: 0,
                lineOfCredit: 'HELOC',
                chunkPayment: 4200,
                chunkMonths: '6,12,18,24'
            },
            'business-debt': {
                income: 12000,
                extraIncome: 0,
                expenses: 8500,
                debtBalance: 75000,
                interestRate: 18,
                minimumPayment: 1500,
                extraPayment: 0,
                lineOfCredit: 'businessLoan',
                chunkPayment: 3000,
                chunkMonths: '2,4,6,8,10'
            },
            'medical-debt': {
                income: 4200,
                extraIncome: 0,
                expenses: 3100,
                debtBalance: 45000,
                interestRate: 0,
                minimumPayment: 500,
                extraPayment: 0,
                lineOfCredit: 'personalLoan',
                chunkPayment: 1200,
                chunkMonths: '4,8,12,16,20'
            },
            'home-equity': {
                income: 9500,
                extraIncome: 0,
                expenses: 6800,
                debtBalance: 120000,
                interestRate: 8.2,
                minimumPayment: 1800,
                extraPayment: 0,
                lineOfCredit: 'HELOC',
                chunkPayment: 3600,
                chunkMonths: '3,6,9,12,15'
            },
            'consolidation': {
                income: 6500,
                extraIncome: 0,
                expenses: 4200,
                debtBalance: 60000,
                interestRate: 14,
                minimumPayment: 1200,
                extraPayment: 0,
                lineOfCredit: 'personalLoan',
                chunkPayment: 2400,
                chunkMonths: '3,6,9,12,15'
            },
            'high-income': {
                income: 25000,
                extraIncome: 0,
                expenses: 15000,
                debtBalance: 200000,
                interestRate: 6,
                minimumPayment: 2500,
                extraPayment: 0,
                lineOfCredit: 'HELOC',
                chunkPayment: 8000,
                chunkMonths: '2,4,6,8,10,12'
            }
        };

        // Load example scenario
        function loadExample(exampleType) {
            const example = examples[exampleType];
            if (!example) return;

            // Populate form fields
            document.getElementById('income').value = example.income;
            document.getElementById('extraIncome').value = example.extraIncome;
            document.getElementById('expenses').value = example.expenses;
            document.getElementById('debtBalance').value = example.debtBalance;
            document.getElementById('interestRate').value = example.interestRate;
            document.getElementById('minimumPayment').value = example.minimumPayment;
            document.getElementById('extraPayment').value = example.extraPayment;
            document.getElementById('lineOfCredit').value = example.lineOfCredit;
            document.getElementById('chunkPayment').value = example.chunkPayment;
            document.getElementById('chunkMonths').value = example.chunkMonths;

            // Close modal
            toggleExamples();

            // Show success message
            if (window.ErrorHandler) {
                window.ErrorHandler.showSuccess(`Loaded ${exampleType.replace('-', ' ')} example! Click Calculate to see results.`);
            } else {
                alert(`Loaded ${exampleType.replace('-', ' ')} example! Click Calculate to see results.`);
            }
        }

        // Input suggestions based on debt amount
        function provideInputSuggestions() {
            const debtBalance = parseFloat(document.getElementById('debtBalance').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            
            if (debtBalance > 0 && interestRate > 0) {
                const monthlyInterest = debtBalance * (interestRate / 100 / 12);
                const suggestedMinPayment = Math.ceil(monthlyInterest + 100);
                const suggestedChunkPayment = Math.ceil(suggestedMinPayment * 2);
                
                // Update placeholders with suggestions
                document.getElementById('minimumPayment').placeholder = `Suggested: $${suggestedMinPayment.toLocaleString()}`;
                document.getElementById('chunkPayment').placeholder = `Suggested: $${suggestedChunkPayment.toLocaleString()}`;
                
                // Show suggestions in feedback
                const feedback = document.getElementById('feedback');
                if (feedback) {
                    feedback.innerHTML = `
                        <div class="suggestion-box">
                            <h4>üí° Input Suggestions for $${debtBalance.toLocaleString()} debt at ${interestRate}% APR:</h4>
                            <p><strong>Minimum Payment:</strong> At least $${suggestedMinPayment.toLocaleString()} (covers $${monthlyInterest.toFixed(2)} interest + $100 principal)</p>
                            <p><strong>Chunk Payment:</strong> $${suggestedChunkPayment.toLocaleString()} (2x minimum payment)</p>
                            <p><strong>Chunk Months:</strong> 3,6,9,12 (every 3 months)</p>
                            <p><strong>Line of Credit:</strong> Credit Card (if available) or Personal Loan</p>
                        </div>
                    `;
                }
            }
        }

        // Add event listeners for input suggestions
        document.addEventListener('DOMContentLoaded', function() {
            const debtInput = document.getElementById('debtBalance');
            const interestInput = document.getElementById('interestRate');
            
            if (debtInput) {
                debtInput.addEventListener('input', provideInputSuggestions);
            }
            if (interestInput) {
                interestInput.addEventListener('input', provideInputSuggestions);
            }
        });

// Apply dark mode on page load
document.addEventListener('DOMContentLoaded', applyDarkMode);

// Listen for dark mode changes from other pages
window.addEventListener('storage', function(e) {
    if (e.key === 'darkMode') {
        applyDarkMode();
    }
});

window.onload = function () {
    function getLineOfCreditBehavior(type) {
        switch(type) {
            case 'creditCard':
                return { rateMultiplier: 1.05, description: 'Credit Card (daily compound)', fee: 0 };
            case 'HELOC':
                return { rateMultiplier: 1.0, description: 'HELOC (simple interest)', fee: 0 };
            case 'personalLoan':
                return { rateMultiplier: 0.95, description: 'Personal Loan (amortized)', fee: 0 };
            case 'businessLoan':
                return { rateMultiplier: 1.1, description: 'Business Loan (interest-only 3 months)', fee: 0 };
            case 'ploc':
                return { rateMultiplier: 1.0, description: 'PLOC (simple interest, fee included)', fee: 0 };
            default:
                return { rateMultiplier: 1.0, description: 'Standard', fee: 0 };
        }
    }

    document.getElementById('saveInputs').addEventListener('click', function () {
        const loadingIndicator = document.getElementById("loadingIndicator");
        loadingIndicator.style.display = "block";
        try {
            const inputs = {
                income: document.getElementById('income').value,
                extraIncome: document.getElementById('extraIncome').value,
                expenses: document.getElementById('expenses').value,
                debtBalance: document.getElementById('debtBalance').value,
                interestRate: document.getElementById('interestRate').value,
                minimumPayment: document.getElementById('minimumPayment').value,
                extraPayment: document.getElementById('extraPayment').value,
                lineOfCredit: document.getElementById('lineOfCredit').value,
                chunkPayment: document.getElementById('chunkPayment').value,
                chunkMonths: document.getElementById('chunkMonths').value
            };
            localStorage.setItem('debtStrategyInputs', JSON.stringify(inputs));
            alert('Inputs saved successfully!');
        } catch (error) {
            alert("Error saving inputs: " + error.message);
        } finally {
            loadingIndicator.style.display = "none";
        }
    });

    document.getElementById('loadInputs').addEventListener('click', function () {
        const loadingIndicator = document.getElementById("loadingIndicator");
        loadingIndicator.style.display = "block";
        try {
            const savedInputs = localStorage.getItem('debtStrategyInputs');
            if (savedInputs) {
                const inputs = JSON.parse(savedInputs);
                document.getElementById('income').value = inputs.income;
                document.getElementById('extraIncome').value = inputs.extraIncome;
                document.getElementById('expenses').value = inputs.expenses;
                document.getElementById('debtBalance').value = inputs.debtBalance;
                document.getElementById('interestRate').value = inputs.interestRate;
                document.getElementById('minimumPayment').value = inputs.minimumPayment;
                document.getElementById('extraPayment').value = inputs.extraPayment;
                document.getElementById('lineOfCredit').value = inputs.lineOfCredit;
                document.getElementById('chunkPayment').value = inputs.chunkPayment;
                document.getElementById('chunkMonths').value = inputs.chunkMonths;
                alert('Inputs loaded successfully!');
            } else {
                alert('No saved inputs found.');
            }
        } catch (error) {
            alert("Error loading inputs: " + error.message);
        } finally {
            loadingIndicator.style.display = "none";
        }
    });

    document.getElementById('exportCsv').addEventListener('click', function () {
        exportStrategyToCSV();
    });

    document.getElementById('exportPdf').addEventListener('click', async function () {
        const loadingIndicator = document.getElementById("pdfLoadingIndicator");
        loadingIndicator.style.display = "block";
        
        try {
            // Check if jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                throw new Error('PDF library not loaded. Please refresh the page and try again.');
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get form data
            const userName = document.getElementById('userName').value || 'User';
            const income = document.getElementById('income').value;
            const extraIncome = document.getElementById('extraIncome').value;
            const expenses = document.getElementById('expenses').value;
            const debtBalance = document.getElementById('debtBalance').value;
            const interestRate = document.getElementById('interestRate').value;
            const minimumPayment = document.getElementById('minimumPayment').value;
            const extraPayment = document.getElementById('extraPayment').value;
            const lineOfCredit = document.getElementById('lineOfCredit').value;
            const chunkPayment = document.getElementById('chunkPayment').value;
            const chunkMonths = document.getElementById('chunkMonths').value;
            
            // Header
            doc.setFontSize(20);
            doc.text("Velocity Banking Strategy Report", 14, 15);
            doc.setFontSize(12);
            doc.text(`Prepared for: ${userName}`, 14, 25);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 35);
            
            // Input Summary Table
            doc.setFontSize(14);
            doc.text("Input Summary", 14, 50);
            
            doc.autoTable({
                startY: 55,
                head: [["Field", "Value"]],
                body: [
                    ["Monthly Income", `$${parseFloat(income || 0).toLocaleString()}`],
                    ["Yearly Extra Income", `$${parseFloat(extraIncome || 0).toLocaleString()}`],
                    ["Monthly Expenses", `$${parseFloat(expenses || 0).toLocaleString()}`],
                    ["Total Debt Balance", `$${parseFloat(debtBalance || 0).toLocaleString()}`],
                    ["Interest Rate", `${interestRate}%`],
                    ["Minimum Payment", `$${parseFloat(minimumPayment || 0).toLocaleString()}`],
                    ["Extra Payment", `$${parseFloat(extraPayment || 0).toLocaleString()}`],
                    ["Line of Credit", lineOfCredit],
                    ["Chunk Payment", `$${parseFloat(chunkPayment || 0).toLocaleString()}`],
                    ["Chunk Months", chunkMonths]
                ],
                styles: { fontSize: 10 },
                headStyles: { fillColor: [0, 123, 255] }
            });
            
            // Results Summary (if available)
            const resultsDiv = document.getElementById('results');
            if (resultsDiv && resultsDiv.innerHTML.trim() !== '') {
                doc.setFontSize(14);
                doc.text("Strategy Results", 14, doc.lastAutoTable.finalY + 20);
                
                // Extract key results
                const resultsText = resultsDiv.innerText;
                const lines = resultsText.split('\n').filter(line => line.trim() !== '');
                
                let yPosition = doc.lastAutoTable.finalY + 35;
                lines.forEach(line => {
                    if (yPosition > 280) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(10);
                    doc.text(line.substring(0, 80), 14, yPosition);
                    yPosition += 10;
                });
            } else {
                doc.setFontSize(12);
                doc.text("Please run the calculation first to see detailed results.", 14, doc.lastAutoTable.finalY + 20);
            }
            
            // Footer
            doc.setFontSize(8);
            doc.text("Generated by Bradley's Financial Tools - A product of Bradley Virtual Solutions, LLC", 14, 285);
            
            // Save the PDF
            const fileName = `velocity-banking-strategy-${userName.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0, 10)}.pdf`;
            doc.save(fileName);
            
        } catch (error) {
            console.error('PDF Export Error:', error);
            alert("Error generating PDF: " + error.message + "\n\nPlease make sure to run the calculation first, then try exporting again.");
        } finally {
            loadingIndicator.style.display = "none";
        }
    });

    document.getElementById('calculator-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const income = parseFloat(document.getElementById('income').value);
        const expenses = parseFloat(document.getElementById('expenses').value);
        const debtBalance = parseFloat(document.getElementById('debtBalance').value);
        const baseInterestRate = parseFloat(document.getElementById('interestRate').value) / 100 / 12;
        const minimumPayment = parseFloat(document.getElementById('minimumPayment').value);
        const extraPayment = parseFloat(document.getElementById('extraPayment').value) || 0;
        const chunkPayment = parseFloat(document.getElementById('chunkPayment').value) || 0;
        const chunkMonths = document.getElementById('chunkMonths').value.split(',').map(Number).filter(n => !isNaN(n) && n > 0);
        const lineOfCredit = document.getElementById('lineOfCredit').value;
        const locBehavior = getLineOfCreditBehavior(lineOfCredit);
        const interestRate = baseInterestRate * locBehavior.rateMultiplier;
        const extraIncome = parseFloat(document.getElementById('extraIncome').value) || 0;
        
        // Get feedback element first
        const feedback = document.getElementById('feedback');
        
        // Input validation
        if (minimumPayment <= 0) {
            feedback.innerHTML = `<p class="feedback high">Error: Minimum monthly payment must be greater than $0. Please enter a valid minimum payment amount.</p>`;
            return;
        }
        
        // Calculate minimum required payment to cover interest
        const monthlyInterest = debtBalance * baseInterestRate;
        const minimumRequiredPayment = monthlyInterest + 1; // At least $1 more than interest
        
        if (minimumPayment < monthlyInterest) {
            feedback.innerHTML = `<p class="feedback high">Error: Your minimum payment (${formatCurrency(minimumPayment)}) is less than the monthly interest (${formatCurrency(monthlyInterest)}). The debt will grow instead of shrink. Please enter a minimum payment of at least ${formatCurrency(minimumRequiredPayment)}.</p>`;
            return;
        }
        
        // Only validate chunk payment and months if user wants to use velocity banking
        if (chunkPayment > 0 && chunkMonths.length === 0) {
            feedback.innerHTML = `<p class="feedback high">Warning: You entered a chunk payment but no months. Please enter valid months for chunk payments (e.g., 3,6,12) or set chunk payment to $0.</p>`;
            return;
        }
        
        if (chunkPayment <= 0 && chunkMonths.length > 0) {
            feedback.innerHTML = `<p class="feedback high">Warning: You entered chunk months but no chunk payment. Please enter a chunk payment amount or clear the months field.</p>`;
            return;
        }
        
        // Calculate suggested minimum payment if not provided
        if (minimumPayment < debtBalance * 0.01) {
            const suggestedMinPayment = Math.max(debtBalance * 0.02, minimumRequiredPayment);
            feedback.innerHTML = `<p class="feedback high">Warning: Your minimum payment seems low. For a $${debtBalance.toLocaleString()} debt at ${(baseInterestRate * 12 * 100).toFixed(1)}% interest, consider a minimum payment of at least ${formatCurrency(suggestedMinPayment)} to make meaningful progress.</p>`;
        }

        const yearlyIncome = income * 12;
        const totalYearlyIncome = yearlyIncome + extraIncome;
        const dtiRatio = (debtBalance / totalYearlyIncome) * 100;
        const cashFlow = income - expenses;
        feedback.innerHTML = `
            <p>Yearly Income (with Extra): ${formatCurrency(totalYearlyIncome)}</p>
            <p>Available Cash Flow: ${formatCurrency(cashFlow)}</p>
            <p>Selected Line of Credit: ${locBehavior.description}</p>
            <p>Extra Payment: ${formatCurrency(extraPayment)}</p>
            <p>Combined Payment (Min + Extra): ${formatCurrency(minimumPayment + extraPayment)}</p>
        `;

        if (lineOfCredit === 'ploc') {
            feedback.innerHTML += `<p><em>Note: PLOC selected ‚Äî make sure any one-time fees (e.g., NetCredit's 10%) are already included in your total debt balance or chunk payments.</em></p>`;
        }

        if (dtiRatio > 43) {
            feedback.innerHTML += `<p class="feedback high">‚ö†Ô∏è Debt-to-Income Ratio: ${dtiRatio.toFixed(2)}% (Too High)</p>`;
        } else {
            feedback.innerHTML += `<p class="feedback normal">‚úÖ Debt-to-Income Ratio: ${dtiRatio.toFixed(2)}% (Within Normal Limits)</p>`;
        }

        if (cashFlow <= 0) {
            feedback.innerHTML += `<p class="feedback high">Insufficient cash flow. Adjust your income or expenses.</p>`;
            return;
        }

        function calculateStrategy(debtBalance, interestRate, payment, strategyName, chunkMonths) {
            let balance = debtBalance, months = 0, totalInterest = 0, payments = [], totalPrincipalPaid = 0;
            
            console.log(`Debug - ${strategyName}: Starting with balance=${balance}, interestRate=${interestRate}, payment=${payment}`);
            console.log(`Debug - ${strategyName}: Monthly interest rate: ${(interestRate * 100).toFixed(4)}%`);

            while (balance > 0 && months < 1500) {
                const interest = balance * interestRate;
                totalInterest += interest;
                let actualPayment = payment;

                const chunkPaymentApplied = chunkMonths.includes(months + 1);
                if (chunkPaymentApplied) {
                    actualPayment += chunkPayment;
                }

                actualPayment = Math.min(actualPayment, balance + interest);
                balance = balance + interest - actualPayment;

                const principalPaid = actualPayment - interest;
                totalPrincipalPaid += principalPaid;

                payments.push({
                    payment: actualPayment.toFixed(2),
                    interest: interest.toFixed(2),
                    balance: balance.toFixed(2),
                    principalPaid: principalPaid.toFixed(2)
                });
                
                // Debug first few iterations
                if (months < 3) {
                    console.log(`Debug - ${strategyName} Month ${months + 1}: balance=${balance.toFixed(2)}, interest=${interest.toFixed(2)}, payment=${actualPayment.toFixed(2)}, totalInterest=${totalInterest.toFixed(2)}`);
                    console.log(`  Before payment: balance=${balance.toFixed(2)}, interest=${interest.toFixed(2)}`);
                    console.log(`  Payment: ${actualPayment.toFixed(2)}, principalPaid: ${principalPaid.toFixed(2)}`);
                    console.log(`  After payment: balance=${balance.toFixed(2)}`);
                }
                
                // Check for runaway balance
                if (balance > debtBalance * 10) {
                    console.error(`ERROR: Balance runaway detected in ${strategyName}!`);
                    console.error(`Balance: ${balance}, Debt Balance: ${debtBalance}, Month: ${months + 1}`);
                    break;
                }

                months++;
            }

            const debtFreeDate = new Date();
            debtFreeDate.setMonth(debtFreeDate.getMonth() + months);
            const yearsToPayoff = (months / 12).toFixed(2);

            console.log(`Debug - ${strategyName}: Final results - Total Interest: ${totalInterest.toFixed(2)}, Months: ${months}, Total Principal: ${totalPrincipalPaid.toFixed(2)}`);

            return { strategyName, totalInterest, months, debtFreeDate, yearsToPayoff, totalPrincipalPaid, payments };
        }

        const minimumStrategy = calculateStrategy(debtBalance, baseInterestRate, minimumPayment, "Minimum Payment", []);
        
        // Only calculate velocity strategy if chunk payment is provided
        let velocityStrategy = null;
        if (chunkPayment > 0 && chunkMonths.length > 0) {
            velocityStrategy = calculateStrategy(debtBalance, interestRate, cashFlow, "Velocity Banking", chunkMonths);
        }
        
        const extraStrategy = calculateStrategy(debtBalance, baseInterestRate, minimumPayment + extraPayment, "Minimum Payments with Extra Payment", []);

        function calculateSavings(baseStrategy, otherStrategy) {
            return baseStrategy.totalInterest - otherStrategy.totalInterest;
        }

        // Calculate savings only for strategies that exist
        let velocitySavings = 0;
        if (velocityStrategy) {
            velocitySavings = calculateSavings(minimumStrategy, velocityStrategy);
        }
        
        const extraSavings = calculateSavings(minimumStrategy, extraStrategy);

        // Debug logging
        console.log('Debug - Interest Calculations:');
        console.log('Minimum Payment:', minimumPayment);
        console.log('Extra Payment:', extraPayment);
        console.log('Combined Payment (min + extra):', minimumPayment + extraPayment);
        console.log('Base Interest Rate:', baseInterestRate);
        console.log('Minimum Strategy Total Interest:', minimumStrategy.totalInterest);
        console.log('Minimum Strategy Months:', minimumStrategy.months);
        if (velocityStrategy) {
            console.log('Velocity Strategy Total Interest:', velocityStrategy.totalInterest);
            console.log('Velocity Savings:', velocitySavings);
        } else {
            console.log('Velocity Strategy: Not calculated (no chunk payment)');
        }
        console.log('Extra Strategy Total Interest:', extraStrategy.totalInterest);
        console.log('Extra Strategy Months:', extraStrategy.months);
        console.log('Extra Strategy Payment:', minimumPayment + extraPayment);
        console.log('Extra Savings:', extraSavings);
        console.log('Extra Savings Calculation:', minimumStrategy.totalInterest, '-', extraStrategy.totalInterest, '=', minimumStrategy.totalInterest - extraStrategy.totalInterest);
        
        // Manual verification
        const manualSavings = minimumStrategy.totalInterest - extraStrategy.totalInterest;
        console.log('Manual Savings Check:', manualSavings);
        console.log('Are they equal?', extraSavings === manualSavings);
        
        // Check if extra payment is actually making a difference
        if (extraPayment > 0) {
            console.log('Extra payment provided, checking if it makes a difference...');
            console.log('Min strategy months:', minimumStrategy.months);
            console.log('Extra strategy months:', extraStrategy.months);
            console.log('Months difference:', minimumStrategy.months - extraStrategy.months);
        }

        // Build strategies array, excluding null velocity strategy
        const strategies = [extraStrategy];
        if (velocityStrategy) {
            strategies.unshift(velocityStrategy); // Add velocity strategy first if it exists
        }
        const bestStrategy = strategies.reduce((best, current) => current.totalInterest < best.totalInterest ? current : best, minimumStrategy);

        const avgMonthlySavings = (minimumStrategy.totalInterest - bestStrategy.totalInterest) / bestStrategy.months;
        let confidenceLevel = '';
        if (cashFlow >= chunkPayment * 1.5) {
            confidenceLevel = 'üöÄ High Confidence ‚Äì Strong Cash Flow';
        } else if (cashFlow >= chunkPayment) {
            confidenceLevel = '‚úÖ Moderate Confidence ‚Äì Cash Flow Sufficient';
        } else {
            confidenceLevel = '‚ö†Ô∏è Low Confidence ‚Äì Tight Cash Flow';
        }

        function renderStrategy(strategy, savings) {
            const limited = strategy.months > 120;
            const limitRows = limited || document.getElementById('limitMonthsToggle').checked;
            const maxRows = limitRows ? 60 : strategy.payments.length;
            const notice = limited ? '<p><em>Only first 60 months shown. Full data is included in totals.</em></p>' : '';

            return `
                <div class="strategy" style="border-top: 4px solid #4CAF50;">
                    <h2>${strategy.strategyName
                        .replace('Minimum Payment', 'üí∞ Minimum Payment Strategy')
                        .replace('Velocity Banking', 'üöÄ Velocity Banking Strategy')
                        .replace('Minimum Payments with Extra Payment', 'üßÆ Extra Payment Strategy')}</h2>
                    ${notice}
                    <p>Total Interest Paid: ${formatCurrency(strategy.totalInterest)}</p>
                    <p>Months to Payoff: ${strategy.months} (${strategy.yearsToPayoff} years)</p>
                    <p>Debt-Free Date: ${strategy.debtFreeDate.toLocaleDateString()}</p>
                    <p>Interest Saved Compared to Minimum Payments: ${formatCurrency(savings)}</p>
                    <p>Total Principal Paid: ${formatCurrency(strategy.totalPrincipalPaid)}</p>
                    <p>Total Amount Paid: ${formatCurrency(strategy.totalPrincipalPaid + strategy.totalInterest)}</p>
                    <table>
                        <tr>
                            <th>Month</th>
                            <th>Payment ($)</th>
                            <th>Principal Paid ($)</th>
                            <th>Interest ($)</th>
                            <th>Balance ($)</th>
                        </tr>
                        ${strategy.payments.slice(0, maxRows).map((p, i) => {
                            return `<tr>
                                <td>${i + 1}</td>
                                <td>${formatCurrency(p.payment)}</td>
                                <td>${formatCurrency(p.principalPaid)}</td>
                                <td>${formatCurrency(p.interest)}</td>
                                <td>${formatCurrency(p.balance)}</td>
                            </tr>`;
                        }).join('')}
                    </table>
                </div>
            `;
        }

        // Render strategies - Velocity Banking first, then others
        console.log('Rendering strategies:');
        console.log('Minimum Strategy Name:', minimumStrategy.strategyName);
        console.log('Extra Strategy Name:', extraStrategy.strategyName);
        if (velocityStrategy) {
            console.log('Velocity Strategy Name:', velocityStrategy.strategyName);
        }
        
        let resultsHTML = '';
        
        // Show Velocity Banking Strategy first (if calculated)
        if (velocityStrategy) {
            resultsHTML += renderStrategy(velocityStrategy, velocitySavings);
        } else {
            resultsHTML += `
                <div class="strategy" style="border-top: 4px solid #6c757d;">
                    <h3>üöÄ Velocity Banking Strategy</h3>
                    <p><em>Not calculated - No chunk payment provided. Enter a chunk payment amount and months to see velocity banking results.</em></p>
                </div>
            `;
        }
        
        // Then show other strategies
        resultsHTML += renderStrategy(minimumStrategy, 0);
        resultsHTML += renderStrategy(extraStrategy, extraSavings);
        
        document.getElementById('results').innerHTML = resultsHTML;

        const recommendedHtml = `
            <p><em>‚úÖ Recommended because it saves the most interest while maintaining a fast payoff timeline.</em></p>
            <p><strong>Recommended Strategy:</strong> ${bestStrategy.strategyName}</p>
            <p>Total Interest: ${formatCurrency(bestStrategy.totalInterest)}</p>
            <p>Months to Payoff: ${bestStrategy.months} months (${bestStrategy.yearsToPayoff} years)</p>
            <p>Debt-Free Date: ${bestStrategy.debtFreeDate.toLocaleDateString()}</p>
            <p>üí∞ Est. Avg. Monthly Savings vs. Minimum: ${formatCurrency(avgMonthlySavings)}</p>
            <p>üìä Payoff Confidence: <strong>${confidenceLevel}</strong></p>
        `;
        
        const userName = document.getElementById('userName').value.trim();
        if (userName) {
            document.getElementById('user-name-display').innerHTML = `üìÑ Strategy Report for <strong>${userName}</strong>`;
        } else {
            document.getElementById('user-name-display').innerHTML = '';
        }

        document.getElementById('recommended-strategy-details').innerHTML = recommendedHtml;
    });

    // Input validation for numeric inputs
    function validateInput(input) {
        const value = parseFloat(input.value);
        if (isNaN(value) || value < 0) {
            input.value = 0;
            alert("Please enter a valid positive number.");
        }
    }

    // Add validation to numeric inputs
    document.querySelectorAll("input[type='number']").forEach(input => {
        input.addEventListener("blur", () => validateInput(input));
    });

    // Dark mode is now controlled globally from the profile settings

    // Load dark mode preference
    if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
    }

    // Export strategy data to CSV
    function exportStrategyToCSV() {
        const inputs = {
            income: document.getElementById('income').value,
            extraIncome: document.getElementById('extraIncome').value,
            expenses: document.getElementById('expenses').value,
            debtBalance: document.getElementById('debtBalance').value,
            interestRate: document.getElementById('interestRate').value,
            minimumPayment: document.getElementById('minimumPayment').value,
            extraPayment: document.getElementById('extraPayment').value,
            lineOfCredit: document.getElementById('lineOfCredit').value,
            chunkPayment: document.getElementById('chunkPayment').value,
            chunkMonths: document.getElementById('chunkMonths').value
        };
        const csvContent = [
            ["Field", "Value"],
            ["Income", inputs.income],
            ["Extra Income", inputs.extraIncome],
            ["Expenses", inputs.expenses],
            ["Debt Balance", inputs.debtBalance],
            ["Interest Rate", inputs.interestRate],
            ["Minimum Payment", inputs.minimumPayment],
            ["Extra Payment", inputs.extraPayment],
            ["Line of Credit", inputs.lineOfCredit],
            ["Chunk Payment", inputs.chunkPayment],
            ["Chunk Months", inputs.chunkMonths]
        ].map(row => row.join(",")).join("\n");
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "strategy_data.csv";
        link.click();
    }
};
</script></body>
</html>
