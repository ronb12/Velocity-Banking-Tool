<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Challenge Library</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }

    summary {
      font-size: 1.1em;
      font-weight: bold;
      padding: 10px;
      background: #007bff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 10px;
    }

    details {
      margin-bottom: 20px;
      border: 1px solid #007bff;
      border-radius: 6px;
      overflow: hidden;
    }

    .challenge-content {
      padding: 15px;
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    li {
      margin-bottom: 8px;
    }

    input[type="checkbox"] {
      margin-right: 10px;
    }

    button, .pdf-btn {
      margin: 10px 10px 0 0;
      padding: 8px 14px;
      font-size: 14px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover, .pdf-btn:hover {
      background-color: #0056b3;
    }

    .stats {
      margin-top: 10px;
      font-weight: bold;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      text-decoration: none;
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
    }

    @media print {
      button, .pdf-btn, .back-link, summary {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a class="back-link" href="index.html">üîô Back to Dashboard</a>
    <h1>üìö Savings Challenge Library</h1>
    <div id="challengeContainer"></div>
  </div>

  <script>
    const challenges = [
      {
        id: '5000_biweekly',
        title: '$5,000 Biweekly Challenge (26 Weeks)',
        pdf: 'pdfs/5000_biweekly.pdf',
        items: Array.from({ length: 26 }, (_, i) => ({ label: `Week ${i+1} - Save $${(i+1)*75}`, amount: (i+1)*75 }))
      },
      {
        id: '52_week_1378',
        title: '$1,378 52-Week Challenge',
        pdf: 'pdfs/52_week_1378.pdf',
        items: Array.from({ length: 52 }, (_, i) => ({ label: `Week ${i+1} - Save $${i+1}`, amount: i+1 }))
      },
      {
        id: '100_envelope',
        title: '100 Envelope Challenge',
        pdf: 'pdfs/100_envelope.pdf',
        items: Array.from({ length: 100 }, (_, i) => ({ label: `Envelope ${i+1} - Save $${i+1}`, amount: i+1 }))
      },
      {
        id: 'emergency_fund_3month',
        title: '3-Month Emergency Fund',
        pdf: 'pdfs/emergency_fund.pdf',
        items: [
          { label: 'Month 1 - Save $1,000', amount: 1000 },
          { label: 'Month 2 - Save $1,000', amount: 1000 },
          { label: 'Month 3 - Save $1,000', amount: 1000 },
        ]
      },
      {
        id: 'no_spend_30day',
        title: '30-Day No Spend Challenge',
        pdf: 'pdfs/no_spend_30day.pdf',
        items: Array.from({ length: 30 }, (_, i) => ({ label: `Day ${i+1} - No unnecessary spending`, amount: 5 }))
      }
    ];

    function loadLibrary() {
      const container = document.getElementById('challengeContainer');
      const openStates = {};

      // Save open states before re-render
      document.querySelectorAll('details').forEach((el, i) => {
        const id = challenges[i]?.id;
        if (id) openStates[id] = el.open;
      });

      container.innerHTML = ''; // Clear

      challenges.forEach(challenge => {
        const savedData = JSON.parse(localStorage.getItem(challenge.id) || '[]');
        const checked = new Array(challenge.items.length).fill(false).map((_, i) => savedData[i] || false);
        const totalSaved = checked.reduce((sum, done, i) => done ? sum + challenge.items[i].amount : sum, 0);

        const details = document.createElement('details');
        if (openStates[challenge.id]) details.open = true;

        const summary = document.createElement('summary');
        summary.textContent = challenge.title;

        const content = document.createElement('div');
        content.className = 'challenge-content';

        const list = document.createElement('ul');
        challenge.items.forEach((item, i) => {
          const li = document.createElement('li');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = checked[i];
          checkbox.onchange = () => {
            checked[i] = checkbox.checked;
            localStorage.setItem(challenge.id, JSON.stringify(checked));
            loadLibrary();
          };
          const label = document.createElement('label');
          label.textContent = item.label;
          li.appendChild(checkbox);
          li.appendChild(label);
          list.appendChild(li);
        });

        const stats = document.createElement('div');
        stats.className = 'stats';
        stats.textContent = `Completed: ${checked.filter(v => v).length} of ${challenge.items.length} | Saved: $${totalSaved}`;

        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'üì§ Export CSV';
        exportBtn.onclick = () => {
          let csv = 'Item,Completed\n';
          challenge.items.forEach((item, i) => {
            csv += `"${item.label}",${checked[i] ? 'Yes' : 'No'}\n`;
          });
          const blob = new Blob([csv], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${challenge.id}.csv`;
          a.click();
        };

        const pdfBtn = document.createElement('a');
        pdfBtn.href = challenge.pdf;
        pdfBtn.target = '_blank';
        pdfBtn.textContent = 'üñ®Ô∏è Download PDF';
        pdfBtn.className = 'pdf-btn';

        content.appendChild(stats);
        content.appendChild(list);
        content.appendChild(exportBtn);
        content.appendChild(pdfBtn);

        details.appendChild(summary);
        details.appendChild(content);
        container.appendChild(details);
      });
    }

    window.onload = loadLibrary;
  </script>
</body>
</html>
