<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bradley's Velocity Banking Toolkit</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f9;
      text-align: center;
    }
    header {
      background: #007bff;
      color: white;
      padding: 1em;
      position: relative;
    }
    button.logout {
      position: absolute;
      right: 20px;
      top: 15px;
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    button.profile-btn {
      position: absolute;
      left: 20px;
      top: 15px;
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .tools {
      padding: 20px;
    }
    .tool-link {
      display: block;
      margin: 10px auto;
      padding: 12px;
      background: #007bff;
      color: white;
      width: 300px;
      border-radius: 8px;
      text-decoration: none;
    }
    canvas {
      max-width: 600px;
      margin: 20px auto;
    }
    .export-buttons {
      margin: 10px;
    }
    .alert {
      background: #ffc107;
      color: black;
      margin: 10px auto;
      padding: 10px;
      border-radius: 5px;
      max-width: 500px;
    }
    #profileBox {
      display: none;
      background: #ffffff;
      border: 1px solid #ccc;
      max-width: 400px;
      margin: 20px auto;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>

<header>
  🚀 Bradley's Dashboard
  <button class="profile-btn" onclick="toggleProfile()">👤 My Profile</button>
  <button class="logout" onclick="logout()">🔒 Logout</button>
</header>

<div id="notification" class="alert" style="display: none;">🔔 Notification will appear here.</div>

<div id="profileBox">
  <h3>👤 Your Profile</h3>
  <p id="profileEmail">Email: ...</p>
  <p id="profileJoinDate">Joined: ...</p>
</div>

<div class="tools">
  <p>Welcome to your personal finance hub. Choose a tool:</p>
  <a class="tool-link" href="Velocity_Calculator.html">📊 Velocity Calculator</a>
  <a class="tool-link" href="Debt_Tracker.html">📋 Debt Tracker</a>
  <a class="tool-link" href="1099_calculator.html">🧾 1099 Tax Calculator</a>
  <a class="tool-link" href="Credit_Score_Estimator.html">💳 Credit Score Estimator</a>
  <a class="tool-link" href="Mobile_Tracker.html">📱 Mobile Debt Tracker</a>
  <a class="tool-link" href="net_worth_tracker.html">🧮 Net Worth Tracker</a>
  <a class="tool-link" href="savings_goal_tracker.html">🏦 Savings Goals</a>
  <a class="tool-link" href="challenge_library.html">📚 Challenge Library</a>
</div>

<canvas id="monthlyChart"></canvas>

<div class="export-buttons">
  <button onclick="exportPDF()">📄 Export PDF</button>
  <button onclick="exportCSV()">📊 Export CSV</button>
  <button onclick="syncCalendar()">📅 Sync to Google Calendar</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDrdga_hOO52nicYN3AwqqDjSbcnre6iM4",
    authDomain: "mobile-debt-tracker.firebaseapp.com",
    projectId: "mobile-debt-tracker",
    storageBucket: "mobile-debt-tracker.firebasestorage.app",
    messagingSenderId: "153601029964",
    appId: "1:153601029964:web:ddd1880ba21bce2e9041e9"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  function logout() {
    auth.signOut().then(() => {
      window.location.href = "login.html";
    });
  }

  function toggleProfile() {
    const box = document.getElementById("profileBox");
    box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
  }

  auth.onAuthStateChanged(async user => {
    if (!user) {
      window.location.href = "login.html";
    } else {
      const userRef = db.collection("users").doc(user.uid);
      const doc = await userRef.get();
      if (!doc.exists) {
        await userRef.set({ email: user.email, joined: new Date().toISOString() });
      }

      const data = doc.data() || { email: user.email, joined: new Date().toISOString() };
      document.getElementById("notification").style.display = "block";
      document.getElementById("notification").innerText = `🔔 Welcome back, ${data.email}`;
      document.getElementById("profileEmail").innerText = `Email: ${data.email}`;
      document.getElementById("profileJoinDate").innerText = `Joined: ${new Date(data.joined).toLocaleDateString()}`;
    }
  });

  const ctx = document.getElementById("monthlyChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May"],
      datasets: [{
        label: "Spending ($)",
        data: [500, 400, 600, 700, 650]
      }]
    }
  });

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Bradley's Dashboard Summary", 10, 10);
    doc.save("dashboard.pdf");
  }

  function exportCSV() {
    const data = [["Month", "Spending"], ["Jan", 500], ["Feb", 400], ["Mar", 600], ["Apr", 700], ["May", 650]];
    const csv = Papa.unparse(data);
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "dashboard.csv";
    a.click();
  }

  function syncCalendar() {
    alert("Google Calendar sync is coming soon.");
  }
</script>

</body>
</html>
