<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register | Bradley's Toolkit</title>
  <link rel="stylesheet" href="theme.css">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
  <div class="register-container">
    <h1>Create Account</h1>
    <div id="error" class="error"></div>
    <div id="success" class="success"></div>
    <form id="registerForm" onsubmit="return false;">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required />
      <button type="submit">Create Account</button>
      <div id="verificationNotice" style="display:none;">Check your email for a verification link.</div>
    </form>
    <a href="login.html">Already have an account? Login</a>
  </div>
  <script type="module">
    import { auth, db } from './firebase-config.js';
    import { createUserWithEmailAndPassword, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { setDoc, doc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    document.getElementById('registerForm').onsubmit = createAccount;

    function validatePassword(password) {
      // Add your password validation logic here
      return password.length >= 8;
    }

    function createAccount() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const errorDiv = document.getElementById("error");
      const successDiv = document.getElementById("success");
      errorDiv.innerText = '';
      successDiv.innerText = '';

      if (password !== confirmPassword) {
        errorDiv.innerText = "Passwords do not match";
        return;
      }
      if (!validatePassword(password)) {
        errorDiv.innerText = "Password must be at least 8 characters.";
        return;
      }
      createUserWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
          await sendEmailVerification(userCredential.user);
          successDiv.innerText = "Account created successfully!";
          document.getElementById("verificationNotice").style.display = "block";
          document.getElementById("registerForm").querySelector('button[type="submit"]').disabled = true;
          // Create user document in Firestore
          await setDoc(doc(db, 'users', userCredential.user.uid), {
            email: email,
            createdAt: new Date().toISOString(),
            verified: false
          });
        })
        .catch(error => {
          errorDiv.innerText = error.message;
        });
    }
  </script>
</body>
</html>
