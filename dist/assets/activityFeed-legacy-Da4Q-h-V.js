System.register(["./modulepreload-polyfill-legacy-CnvmjJHj.js","./auth-legacy-CXkRVKZL.js","./theme-legacy-Bd_heFTc.js","https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js","https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js","https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"],function(t,e){"use strict";var n,i,a,s,o,d,l;return{setters:[null,null,null,t=>{n=t.Timestamp,i=t.deleteDoc,a=t.doc,s=t.query,o=t.collection,d=t.orderBy,l=t.getDocs},null,null],execute:function(){let t,e=[],c=null;const r=["localhost","127.0.0.1"].includes(window.location.hostname);function y(){try{const t=localStorage.getItem("local_test_activity");if(t)return JSON.parse(t)}catch(n){}const t=window.getLocalTestData&&window.getLocalTestData("activityLogs")||window.LOCAL_TEST_DATA?.activityLogs||[];return e=t,JSON.parse(JSON.stringify(e));var e}function g(t=!1){const n=document.getElementById("activityFeed"),i=document.getElementById("loading"),a=y();if(i.style.display="none",e=a.map(t=>({...t})),v(),!e.length)return void(n.innerHTML='\n          <div class="empty-state">\n            <div style="font-size: 4em; margin-bottom: 20px;">üìù</div>\n            <h3>No activities yet</h3>\n            <p>Start using the financial tools to see your activity feed here!</p>\n          </div>\n        ');let s="";e.forEach((e,n)=>{const i=t&&n<3,a=p(e.type),o=m(e.timestamp);s+=`\n          <div class="entry ${i?"new":""}">\n            <div class="entry-left">\n              <div class="entry-icon">${e.icon||"üìù"}</div>\n              <div>\n                <div class="entry-text">${e.text||"Activity logged"}</div>\n                ${e.type?`<span class="entry-type ${a}">${e.type.replace("_"," ")}</span>`:""}\n              </div>\n            </div>\n            <div class="entry-time">${o}</div>\n          </div>\n        `}),n.innerHTML=s,c=new Date}function p(t){return{debt_payment:"type-debt",debt_added:"type-debt",debt_updated:"type-debt",debt_deleted:"type-debt",budget_created:"type-budget",budget_updated:"type-budget",budget_spent:"type-budget",savings_goal_created:"type-savings",savings_goal_updated:"type-savings",savings_goal_completed:"type-savings",savings_contribution:"type-savings",net_worth_updated:"type-networth",velocity_calculated:"type-velocity",tax_calculated:"type-tax",login:"type-login",logout:"type-login"}[t]||"type-login"}function m(t){if(!t)return"Just now";const e=new Date,n=t.seconds?new Date(1e3*t.seconds):new Date(t),i=e-n,a=Math.floor(i/6e4),s=Math.floor(a/60),o=Math.floor(s/24);return a<1?"Just now":a<60?`${a}m ago`:s<24?`${s}h ago`:o<7?`${o}d ago`:n.toLocaleDateString()}function v(){const t=e.length,n=e.filter(t=>t.type&&t.type.startsWith("debt")).length,i=e.filter(t=>t.type&&t.type.startsWith("savings")).length,a=new Date,s=new Date(a.getTime()-864e5),o=e.filter(t=>(t.timestamp?.seconds?new Date(1e3*t.timestamp.seconds):new Date(t.timestamp))>s).length;document.getElementById("totalActivities").textContent=t,document.getElementById("debtActivities").textContent=n,document.getElementById("savingsActivities").textContent=i,document.getElementById("recentActivities").textContent=o}async function u(t,n=!1){const i=document.getElementById("activityFeed"),a=document.getElementById("loading");if(a.style.display="block",r)g(n);else try{const r=s(o(db,"users",t.uid,"activity_logs"),d("timestamp","desc")),y=await l(r);if(a.style.display="none",e=[],y.forEach(t=>{e.push({id:t.id,...t.data()})}),v(),0===e.length)return void(i.innerHTML='\n            <div class="empty-state">\n              <div style="font-size: 4em; margin-bottom: 20px;">üìù</div>\n              <h3>No activities yet</h3>\n              <p>Start using the financial tools to see your activity feed here!</p>\n            </div>\n          ');let g="";e.forEach((t,e)=>{const i=n&&e<3,a=p(t.type),s=m(t.timestamp);g+=`\n            <div class="entry ${i?"new":""}">\n              <div class="entry-left">\n                <div class="entry-icon">${t.icon||"üìù"}</div>\n                <div>\n                  <div class="entry-text">${t.text||"Activity logged"}</div>\n                  ${t.type?`<span class="entry-type ${a}">${t.type.replace("_"," ")}</span>`:""}\n                </div>\n              </div>\n              <div class="entry-time">${s}</div>\n            </div>\n          `}),i.innerHTML=g,c=new Date}catch(y){a.style.display="none",i.innerHTML='\n          <div class="empty-state">\n            <div style="font-size: 4em; margin-bottom: 20px;">‚ùå</div>\n            <h3>Error loading activities</h3>\n            <p>Please try refreshing the page.</p>\n          </div>\n        '}}function h(){t=r?setInterval(()=>{g(!0)},3e4):setInterval(()=>{const t=auth.currentUser;t&&u(t,!0)},3e4)}function f(){t&&clearInterval(t)}window.refreshFeed=()=>{const t=auth.currentUser;t&&!r?u(t,!0):r&&g(!0)},window.clearOldActivities=async()=>{const t=auth.currentUser;if((t||r)&&confirm("Clear activities older than 30 days? This action cannot be undone.")){if(r){const t=new Date;t.setDate(t.getDate()-30);const n=y().filter(e=>(e.timestamp?.seconds?new Date(1e3*e.timestamp.seconds):new Date(e.timestamp||Date.now()))>=t);return function(t){try{localStorage.setItem("local_test_activity",JSON.stringify(t))}catch(e){}}(n),alert(`Cleared ${e.length-n.length} old activities`),void g()}try{const s=new Date;s.setDate(s.getDate()-30),n.fromDate(s);const o=e.filter(t=>(t.timestamp?.seconds?new Date(1e3*t.timestamp.seconds):new Date(t.timestamp))<s),d=o.map(e=>i(a(db,"users",t.uid,"activity_logs",e.id)));await Promise.all(d),alert(`Cleared ${o.length} old activities`),u(t)}catch(s){alert("Error clearing old activities")}}},(async()=>{try{const{auth:t}=await waitForAuth(1e4);window.auth=t,t.onAuthStateChanged(t=>{t?(u(t),h()):r?(g(),h()):(document.getElementById("activityFeed").innerHTML='\n              <div class="empty-state">\n                <div style="font-size: 4em; margin-bottom: 20px;">üîê</div>\n                <h3>Please log in</h3>\n                <p>You need to be logged in to view your activity feed.</p>\n                <a href="/src/pages/auth/login.html" class="btn btn-primary" style="margin-top: 20px;">Login</a>\n              </div>\n            ',document.getElementById("loading").style.display="none",f())})}catch(t){r?(g(),h()):(document.getElementById("activityFeed").innerHTML='\n            <div class="empty-state">\n              <div style="font-size: 4em; margin-bottom: 20px;">üîê</div>\n              <h3>Please log in</h3>\n              <p>You need to be logged in to view your activity feed.</p>\n              <a href="/src/pages/auth/login.html" class="btn btn-primary" style="margin-top: 20px;">Login</a>\n            </div>\n          ',document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),f())}})(),window.addEventListener("beforeunload",f)}}});
