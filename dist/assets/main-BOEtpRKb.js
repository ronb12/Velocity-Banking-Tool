const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DHUquEJ3.js","assets/preload-helper-BzSHXCLh.js","assets/index-CfCPgnOI.js","assets/index-CZ_7m6oL.js","assets/index-DBW9XBgT.js","assets/index-DCowlDrX.js","assets/index-D2BIqEI9.js","assets/index-L_VuN3GY.js"])))=>i.map(i=>d[i]);
function t(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}import"./modulepreload-polyfill-YP0FEG5d.js";import{_ as e}from"./preload-helper-BzSHXCLh.js";import"./auth-D-ZYIE7C.js";import"./sync-BSpl6rnS.js";import"https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";let n=!1,o=null;async function i(){try{if("undefined"==typeof window||!window.Capacitor)return!1;if(window.Capacitor){n=!0,o=window.Capacitor;try{const t=await e(()=>import("./index-DHUquEJ3.js"),__vite__mapDeps([0,1,2]));window.CapacitorApp=t.App}catch(t){}try{const t=await e(()=>import("./index-CZ_7m6oL.js"),__vite__mapDeps([3,1,2]));window.CapacitorHaptics=t.Haptics}catch(t){}try{const t=await e(()=>import("./index-DBW9XBgT.js"),__vite__mapDeps([4,2]));window.CapacitorKeyboard=t.Keyboard}catch(t){}try{const t=await e(()=>import("./index-DCowlDrX.js"),__vite__mapDeps([5,2]));window.CapacitorStatusBar=t.StatusBar}catch(t){}try{const t=await e(()=>import("./index-D2BIqEI9.js"),__vite__mapDeps([6,1,2]));window.CapacitorPreferences=t.Preferences}catch(t){}try{const t=await e(()=>import("./index-L_VuN3GY.js"),__vite__mapDeps([7,1,2]));window.CapacitorNetwork=t.Network}catch(t){}return function(){if(!window.CapacitorApp)return;window.CapacitorApp.addListener("appStateChange",({isActive:t})=>{t?window.dispatchEvent(new CustomEvent("app-foreground")):window.dispatchEvent(new CustomEvent("app-background"))}),window.CapacitorApp.addListener("appUrlOpen",t=>{window.dispatchEvent(new CustomEvent("app-url-open",{detail:t}))}),window.CapacitorApp.addListener("backButton",()=>{window.history.length>1?window.history.back():window.CapacitorApp.exitApp()})}(),async function(){if(!window.CapacitorStatusBar)return;try{await window.CapacitorStatusBar.setStyle({style:"DARK"}),await window.CapacitorStatusBar.setBackgroundColor({color:"#007bff"}),await window.CapacitorStatusBar.setOverlaysWebView({overlay:!1})}catch(t){}}(),function(){if(!window.CapacitorKeyboard)return;window.CapacitorKeyboard.addListener("keyboardWillShow",t=>{window.dispatchEvent(new CustomEvent("keyboard-show",{detail:t}))}),window.CapacitorKeyboard.addListener("keyboardWillHide",()=>{window.dispatchEvent(new CustomEvent("keyboard-hide"))}),window.CapacitorKeyboard.setStyle({style:"DARK"}),window.CapacitorKeyboard.setResizeMode({mode:"NATIVE"})}(),!0}return!1}catch(i){return!1}}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i());class a{constructor(){this.errorListeners=[],this.errorCount=0,this.maxErrors=10,this.errorWindow=6e4,this.errorTimestamps=[],this._lastError=null,this._rateLimitWarning=null}init(){if(window.addEventListener("error",t=>{this.handleError(t.error||t.message,{filename:t.filename,lineno:t.lineno,colno:t.colno,type:"javascript_error"})}),window.addEventListener("unhandledrejection",t=>{this.handleError(t.reason,{type:"unhandled_promise_rejection"})}),!console.error._errorBoundaryWrapped){const t=function(){}.bind(),e=this;console.error._originalError=t,console.error=function(...n){t.apply(console,n);const o=n.join(" "),i=Date.now();(!e._lastError||e._lastError.message!==o||i-e._lastError.timestamp>1e3)&&(e._lastError={message:o,timestamp:i})},console.error._errorBoundaryWrapped=!0}}handleError(t,e={}){if("console_error"===e.type)return;const n=Date.now();if(this.errorTimestamps=this.errorTimestamps.filter(t=>n-t<this.errorWindow),this.errorTimestamps.length>=this.maxErrors)return void((!this._rateLimitWarning||n-this._rateLimitWarning>6e4)&&(this._rateLimitWarning=n));this.errorTimestamps.push(n),this.errorCount++;const o={message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,...e};this.logError(o),this.errorListeners.forEach(t=>{try{t(o)}catch(e){console.error._originalError}}),this.showUserError(o)}logError(t){if("undefined"!=typeof window&&window.ErrorHandler)try{window.ErrorHandler.logError(t)}catch(e){console.error._originalError}try{const e=JSON.parse(localStorage.getItem("app_errors")||"[]");e.unshift(t),e.splice(10),localStorage.setItem("app_errors",JSON.stringify(e))}catch(e){}}showUserError(t){if("console_error"!==t.type&&"undefined"!=typeof window&&window.showNotification){const e=this.getUserFriendlyMessage(t);window.showNotification(e,"error")}}getUserFriendlyMessage(t){const e=t.message.toLowerCase();return e.includes("network")||e.includes("fetch")?"Network error. Please check your connection and try again.":e.includes("firebase")||e.includes("auth")?"Authentication error. Please try logging in again.":e.includes("permission")||e.includes("denied")?"Permission denied. Please check your account settings.":e.includes("quota")||e.includes("limit")?"Storage limit reached. Please free up some space.":"An unexpected error occurred. Please try again or contact support if the problem persists."}addErrorListener(t){this.errorListeners.push(t)}removeErrorListener(t){this.errorListeners=this.errorListeners.filter(e=>e!==t)}wrapAsync(t,e="unknown"){return async(...n)=>{try{return await t(...n)}catch(o){throw this.handleError(o,{context:e,type:"async_error"}),o}}}async retry(t,e=3,n=1e3){let o;for(let a=0;a<e;a++)try{return await t()}catch(i){if(o=i,i.message&&(i.message.includes("permission")||i.message.includes("auth")||i.message.includes("invalid")))throw i;a<e-1&&await new Promise(t=>setTimeout(t,n*(a+1)))}throw o}}const r=new a;"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{r.init()}):r.init()),window.ErrorBoundary=a,window.errorBoundary=r;class s{constructor(){this.logs=[],this.maxLogs=100,this.levels={DEBUG:0,INFO:1,WARN:2,ERROR:3},this.currentLevel=this.levels.INFO,this.enableConsole="undefined"==typeof process||!1}debug(t,e={}){this.log("DEBUG",t,e)}info(t,e={}){this.log("INFO",t,e)}warn(t,e={}){this.log("WARN",t,e)}error(t,e={}){this.log("ERROR",t,e)}log(t,e,n={}){const o={level:t,message:e,data:n,timestamp:(new Date).toISOString(),url:"undefined"!=typeof window?window.location.href:"unknown",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown"};if(this.logs.push(o),this.logs.length>this.maxLogs&&this.logs.shift(),this.enableConsole&&this.levels[t]>=this.currentLevel){}if("undefined"!=typeof window&&window.analytics)try{window.analytics.track("log",{level:t,message:e.substring(0,100)})}catch(i){}}getLogs(t=10,e=null){let n=[...this.logs].reverse();return e&&(n=n.filter(t=>t.level===e)),n.slice(0,t)}clearLogs(){this.logs=[]}setLevel(t){void 0!==this.levels[t]&&(this.currentLevel=this.levels[t])}}const c=new s;window.Logger=s,window.logger=c,"undefined"!=typeof process&&(console.log=(...t)=>c.info(t.join(" ")),console.debug=(...t)=>c.debug(t.join(" ")),console.info=(...t)=>c.info(t.join(" ")));class d{constructor(){this.patterns={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[\d\s\-\+\(\)]+$/,url:/^https?:\/\/.+/,numeric:/^\d+(\.\d+)?$/,alphanumeric:/^[a-zA-Z0-9\s]+$/,currency:/^\$?\d+(\.\d{2})?$/}}validateEmail(t){return!(!t||"string"!=typeof t)&&this.patterns.email.test(t.trim())}validateString(t,e={}){const{minLength:n=0,maxLength:o=1/0,required:i=!1,pattern:a=null,trim:r=!0}=e;if(i&&(!t||0===t.trim().length))return{valid:!1,sanitized:"",error:"This field is required"};if(!t)return{valid:!i,sanitized:"",error:i?"This field is required":null};const s=String(t);let c=r?s.trim():s;return c.length<n?{valid:!1,sanitized:c,error:"Must be at least ".concat(n," characters")}:c.length>o?{valid:!1,sanitized:c,error:"Must be no more than ".concat(o," characters")}:a&&!a.test(c)?{valid:!1,sanitized:c,error:"Invalid format"}:(c=this.sanitizeHTML(c),{valid:!0,sanitized:c,error:null})}validateNumber(t,e={}){const{min:n=-1/0,max:o=1/0,required:i=!1,integer:a=!1}=e;if(i&&(null==t||""===t))return{valid:!1,value:null,error:"This field is required"};if(null==t||""===t)return{valid:!i,value:null,error:i?"This field is required":null};const r=Number(t);return isNaN(r)?{valid:!1,value:null,error:"Must be a valid number"}:a&&!Number.isInteger(r)?{valid:!1,value:r,error:"Must be an integer"}:r<n?{valid:!1,value:r,error:"Must be at least ".concat(n)}:r>o?{valid:!1,value:r,error:"Must be no more than ".concat(o)}:{valid:!0,value:r,error:null}}validateCurrency(t,e={}){const{min:n=0,max:o=1/0,required:i=!1}=e,a=String(t).replace(/[$,\s]/g,""),r=this.validateNumber(a,{min:n,max:o,required:i});if(!r.valid)return r;return{valid:!0,value:Math.round(100*r.value)/100,error:null}}sanitizeHTML(t){if(!t||"string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}sanitizeForDB(t){if(null==t)return null;if("string"==typeof t)return this.sanitizeHTML(t.trim());if("number"==typeof t)return isNaN(t)?null:t;if(Array.isArray(t))return t.map(t=>this.sanitizeForDB(t));if("object"==typeof t){const e={};for(const[n,o]of Object.entries(t)){e[this.sanitizeHTML(String(n))]=this.sanitizeForDB(o)}return e}return t}validateForm(t,e){const n={},o={};for(const[i,a]of Object.entries(e)){const e=t[i];let r;if("string"===a.type)r=this.validateString(e,a);else if("number"===a.type)r=this.validateNumber(e,a);else if("currency"===a.type)r=this.validateCurrency(e,a);else if("email"===a.type){const t=this.validateEmail(e);r={valid:t,sanitized:t?e.trim():"",error:t?null:"Invalid email address"}}else r={valid:!0,sanitized:e,error:null};r.valid||(n[i]=r.error),o[i]=void 0!==r.sanitized?r.sanitized:r.value}return{valid:0===Object.keys(n).length,errors:n,sanitized:o}}}const l=new d;window.InputValidator=d,window.inputValidator=l;class u{constructor(){this.requests=new Map,this.defaultLimit={window:6e4,max:60}}check(t,e={}){const n={window:e.window||this.defaultLimit.window,max:e.max||this.defaultLimit.max},o=Date.now();let i=this.requests.get(t);i&&o-i.windowStart>n.window&&(i=null),i||(i={count:0,windowStart:o},this.requests.set(t,i));const a=Math.max(0,n.max-i.count),r=i.count<n.max;r&&i.count++;return{allowed:r,remaining:a,resetTime:i.windowStart+n.window,limit:n.max}}reset(t){this.requests.delete(t)}clear(){this.requests.clear()}cleanup(){const t=Date.now();for(const[e,n]of this.requests.entries())t-n.windowStart>36e5&&this.requests.delete(e)}}const m=new u;"undefined"!=typeof window&&setInterval(()=>{m.cleanup()},3e5),window.RateLimiter=u,window.rateLimiter=m;class p{constructor(){this.csrfToken=this.generateCSRFToken(),this.rateLimits=new Map}generateCSRFToken(){const t=new Uint8Array(32);return crypto.getRandomValues(t),Array.from(t,t=>t.toString(16).padStart(2,"0")).join("")}validateCSRFToken(t){return t===this.csrfToken}sanitizeForDisplay(t){if(!t||"string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}isSafeURL(t){if(!t||"string"!=typeof t)return!1;try{const e=new URL(t,window.location.origin);return["http:","https:",""].includes(e.protocol)}catch(e){return!1}}validateFileUpload(t,e={}){const{maxSize:n=5242880,allowedTypes:o=["image/jpeg","image/png","image/gif","application/pdf"],allowedExtensions:i=[".jpg",".jpeg",".png",".gif",".pdf"]}=e;if(!t)return{valid:!1,error:"No file provided"};if(t.size>n)return{valid:!1,error:"File size exceeds maximum of ".concat(n/1024/1024,"MB")};if(!o.includes(t.type))return{valid:!1,error:"File type not allowed"};const a="."+t.name.split(".").pop().toLowerCase();return i.includes(a)?{valid:!0,error:null}:{valid:!1,error:"File extension not allowed"}}async hashData(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")}checkRateLimit(t,e=10,n=6e4){const o=Date.now(),i=this.rateLimits.get(t);return!i||o-i.start>n?(this.rateLimits.set(t,{start:o,count:1}),!1):i.count>=e||(i.count++,!1)}clearRateLimit(t){this.rateLimits.delete(t)}cleanupRateLimits(){const t=Date.now();for(const[e,n]of this.rateLimits.entries())t-n.start>3e5&&this.rateLimits.delete(e)}}const h=new p;"undefined"!=typeof window&&setInterval(()=>{h.cleanupRateLimits()},3e5),window.SecurityService=p,window.securityService=h;class g{constructor(){this.insights=[],this.recommendations=[]}renderInsights(t,e){t&&0!==t.length?(this.insights=t,e.innerHTML=t.map(t=>'\n      <div class="insight-card">\n        <h3>'.concat(t.title,'</h3>\n        <div class="insight-data">\n          ').concat(Object.entries(t.data).map(([t,e])=>'\n            <div class="data-point">\n              <span class="data-label">'.concat(this.formatKey(t),':</span>\n              <span class="data-value">').concat(this.formatValue(e),"</span>\n            </div>\n          ")).join(""),"\n        </div>\n      </div>\n    ")).join("")):e.innerHTML='\n        <div class="info-state">\n          <h3>üí° Get Started with Financial Insights</h3>\n          <p>Add some financial data using the tools above to get personalized insights and recommendations:</p>\n          <ul style="text-align: left; margin: 1rem 0;">\n            <li>üìã Use the <strong>Debt Tracker</strong> to add your debts</li>\n            <li>üí∞ Use the <strong>Budget Tracker</strong> to set up your budget</li>\n            <li>üíé Use the <strong>Net Worth Tracker</strong> to track your assets</li>\n            <li>üéØ Use the <strong>Savings Goal Tracker</strong> to set savings goals</li>\n          </ul>\n          <p>Once you add some data, we\'ll provide personalized insights and recommendations!</p>\n        </div>\n      '}renderRecommendations(t,e){t&&0!==t.length?(this.recommendations=t,e.innerHTML=t.map(t=>'\n      <div class="recommendation-card priority-'.concat(t.priority,'">\n        <div class="recommendation-header">\n          <h3>').concat(t.title,'</h3>\n          <span class="priority-badge">Priority ').concat(t.priority,'</span>\n        </div>\n        <p class="recommendation-description">').concat(t.description,'</p>\n        <div class="recommendation-action">\n          <strong>Action:</strong> ').concat(t.action,"\n        </div>\n      </div>\n    ")).join("")):e.innerHTML='\n        <div class="info-state">\n          <h3>üéØ Personalized Recommendations</h3>\n          <p>Once you start using the financial tools above, we\'ll analyze your data and provide personalized recommendations to help you:</p>\n          <ul style="text-align: left; margin: 1rem 0;">\n            <li>üí≥ Optimize your credit utilization</li>\n            <li>üìä Improve your debt payoff strategy</li>\n            <li>üí∞ Better manage your budget</li>\n            <li>üéØ Reach your savings goals faster</li>\n          </ul>\n          <p>Start by adding some financial data using the tools above!</p>\n        </div>\n      '}formatKey(t){return t.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}formatValue(t){return"number"==typeof t?t>1e3?"$".concat(t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})):t<1||"number"==typeof t&&t<=100&&t>0?"".concat((100*t).toFixed(1),"%"):t<10?t.toFixed(2):t.toFixed(1):"object"==typeof t&&null!==t?t.name&&void 0!==t.interestRate?"".concat(t.name," (").concat(t.interestRate.toFixed(1),"%)"):JSON.stringify(t):t}}const w=new g;window.FinancialInsights=g,window.financialInsights=w;class f{constructor(){this.jsPDFLoaderPromise=null}async loadJsPDF(){return window.jspdf&&window.jspdf.jsPDF?window.jspdf.jsPDF:(this.jsPDFLoaderPromise||(this.jsPDFLoaderPromise=new Promise((t,e)=>{const n=document.querySelector('script[data-jspdf="true"]');if(n)return n.addEventListener("load",()=>{window.jspdf&&window.jspdf.jsPDF?t(window.jspdf.jsPDF):e(new Error("jsPDF loaded but constructor missing"))}),void n.addEventListener("error",()=>e(new Error("Failed to load jsPDF script")));const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",o.async=!0,o.dataset.jspdf="true",o.onload=()=>{window.jspdf&&window.jspdf.jsPDF?t(window.jspdf.jsPDF):e(new Error("jsPDF loaded but constructor missing"))},o.onerror=()=>e(new Error("Failed to load jsPDF script")),document.head.appendChild(o)})),this.jsPDFLoaderPromise)}async exportAllData(t,e,n,o){var i,a,r,s,c,d;try{e("Preparing data export...","info");const l=await n(),u=o(l),m={displayName:localStorage.getItem("profileName")||(null==(a=null==(i=window.auth)?void 0:i.currentUser)?void 0:a.displayName)||"Bradley's Finance Hub Member",email:localStorage.getItem("profileEmail")||(null==(s=null==(r=window.auth)?void 0:r.currentUser)?void 0:s.email)||"Not linked",uid:(null==(d=null==(c=window.auth)?void 0:c.currentUser)?void 0:d.uid)||"",generatedAt:(new Date).toISOString()},p={exportInfo:{timestamp:(new Date).toISOString(),version:"2.1.0",format:t,userAgent:navigator.userAgent},account:m,userSettings:{darkMode:"true"===localStorage.getItem("darkMode"),theme:localStorage.getItem("theme"),notificationsEnabled:"false"!==localStorage.getItem("notificationsEnabled"),autoSaveEnabled:"false"!==localStorage.getItem("autoSaveEnabled"),showTipsEnabled:"false"!==localStorage.getItem("showTipsEnabled"),userAvatar:localStorage.getItem("userAvatar")?"Present":"Not set"},financialData:l,summary:u};"json"===t?this.exportAsJSON(p):"csv"===t?this.exportAsCSV(p):"pdf"===t&&await this.exportAsPDF(p),e("Data exported successfully as ".concat(t.toUpperCase(),"!"),"success")}catch(l){e("Export failed. Please try again.","error")}}exportAsJSON(t){const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download="bradley-financial-data-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}exportAsCSV(t){let e="Data Type,Field,Value,Timestamp\n";e+="Export Info,Format,".concat(t.exportInfo.format,",").concat(t.exportInfo.timestamp,"\n"),e+="Export Info,Version,".concat(t.exportInfo.version,",").concat(t.exportInfo.timestamp,"\n"),Object.entries(t.userSettings).forEach(([n,o])=>{e+="User Settings,".concat(n,",").concat(o,",").concat(t.exportInfo.timestamp,"\n")}),Object.entries(t.financialData).forEach(([n,o])=>{Array.isArray(o)?o.forEach(o=>{Object.entries(o).forEach(([o,i])=>{e+="".concat(n,",").concat(o,",").concat(i,",").concat(t.exportInfo.timestamp,"\n")})}):"object"==typeof o&&Object.entries(o).forEach(([o,i])=>{e+="".concat(n,",").concat(o,",").concat(JSON.stringify(i),",").concat(t.exportInfo.timestamp,"\n")})});const n=new Blob([e],{type:"text/csv"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download="bradley-financial-data-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}async exportAsPDF(t){try{const t=await this.loadJsPDF();if(!t)throw new Error("Unable to load jsPDF library");const e=new t({unit:"pt",format:"letter"});e.setFontSize(22),e.text("Bradley's Finance Hub - Financial Report",50,50),e.setFontSize(12),e.text("Generated: ".concat((new Date).toLocaleString()),50,80),e.save("bradley-financial-report-".concat((new Date).toISOString().split("T")[0],".pdf"))}catch(e){throw e}}}const y=new f;window.DataExport=f,window.dataExport=y;class v{constructor(){this.tips=[],this.currentTipIndex=0,this.rotationInterval=null}init(t){this.tips=t||[],this.currentTipIndex=0,this.updateTipDisplay(),this.startTipRotation()}updateTipDisplay(){if(0===this.tips.length)return;const t=this.tips[this.currentTipIndex];if(!t)return;const e=document.getElementById("tipCategory"),n=document.getElementById("tipNumber"),o=document.getElementById("tipTitle"),i=document.getElementById("tipContent");e&&(e.textContent=t.category),n&&(n.textContent="".concat(this.currentTipIndex+1," of ").concat(this.tips.length)),o&&(o.textContent=t.title),i&&(i.textContent=t.content),document.querySelectorAll(".nav-dot").forEach((t,e)=>{t.classList.toggle("active",e===this.currentTipIndex)})}nextTip(){this.currentTipIndex=(this.currentTipIndex+1)%this.tips.length,this.updateTipDisplay()}previousTip(){0===this.currentTipIndex?this.currentTipIndex=this.tips.length-1:this.currentTipIndex=this.currentTipIndex-1,this.updateTipDisplay()}goToTip(t){t>=0&&t<this.tips.length&&(this.currentTipIndex=t,this.updateTipDisplay())}startTipRotation(){this.stopTipRotation(),this.rotationInterval=setInterval(()=>{this.nextTip()},1e4)}stopTipRotation(){this.rotationInterval&&(clearInterval(this.rotationInterval),this.rotationInterval=null)}}const b=new v;window.FinancialTips=v,window.financialTips=b,window.nextTip=()=>b.nextTip(),window.previousTip=()=>b.previousTip(),window.goToTip=t=>b.goToTip(t);class S{constructor(){this.settings={darkMode:!1,notifications:!0,autoSave:!0,showTips:!0}}loadSettings(){var t,e,n;const o=document.getElementById("settingsDarkMode"),i="true"===localStorage.getItem("darkMode")||"dark"===localStorage.getItem("theme");o&&(o.checked=i),i?document.body.classList.add("dark"):document.body.classList.remove("dark");const a=document.getElementById("settingsNotifications"),r=document.getElementById("settingsAutoSave"),s=document.getElementById("settingsShowTips");a&&(a.checked="false"!==localStorage.getItem("notificationsEnabled")),r&&(r.checked="false"!==localStorage.getItem("autoSaveEnabled")),s&&(s.checked="false"!==localStorage.getItem("showTipsEnabled"));const c=localStorage.getItem("userAvatar");if(c){const t=document.getElementById("profileAvatar");t&&(t.src=c)}this.settings={darkMode:i,notifications:null==(t=null==a?void 0:a.checked)||t,autoSave:null==(e=null==r?void 0:r.checked)||e,showTips:null==(n=null==s?void 0:s.checked)||n},"undefined"!=typeof window&&window.logger&&window.logger.debug("Settings loaded",{darkMode:i})}saveSetting(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){"undefined"!=typeof window&&window.logger&&window.logger.error("Failed to save setting",{key:t,error:n.message})}}loadSetting(t,e=null){try{const n=localStorage.getItem(t);return n?JSON.parse(n):e}catch(n){return"undefined"!=typeof window&&window.logger&&window.logger.error("Failed to load setting",{key:t,error:n.message}),e}}toggleDarkMode(){const t=document.getElementById("settingsDarkMode");if(!t)return void("undefined"!=typeof window&&window.logger&&window.logger.error("Dark mode toggle not found"));const e=t.checked;e?(document.body.classList.add("dark"),localStorage.setItem("theme","dark"),localStorage.setItem("darkMode","true")):(document.body.classList.remove("dark"),localStorage.setItem("theme","light"),localStorage.setItem("darkMode","false")),this.settings.darkMode=e,"function"==typeof window.showNotification&&window.showNotification("Dark mode ".concat(e?"enabled":"disabled"),"success")}toggleNotifications(){const t=document.getElementById("settingsNotifications").checked;localStorage.setItem("notificationsEnabled",t.toString()),this.settings.notifications=t,t&&"Notification"in window&&Notification.requestPermission(),"function"==typeof window.showNotification&&window.showNotification("Notifications ".concat(t?"enabled":"disabled"),"success")}toggleAutoSave(){const t=document.getElementById("settingsAutoSave").checked;localStorage.setItem("autoSaveEnabled",t.toString()),this.settings.autoSave=t,"function"==typeof window.showNotification&&window.showNotification("Auto-save ".concat(t?"enabled":"disabled"),"success")}toggleShowTips(){const t=document.getElementById("settingsShowTips").checked;localStorage.setItem("showTipsEnabled",t.toString()),this.settings.showTips=t;const e=document.querySelector(".financial-education");e&&(e.style.display=t?"block":"none"),"function"==typeof window.showNotification&&window.showNotification("Tips ".concat(t?"enabled":"disabled"),"success")}handleAvatarUpload(t){const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{const e=document.getElementById("profileAvatar");e&&(e.src=t.target.result),localStorage.setItem("userAvatar",t.target.result),"function"==typeof window.showNotification&&window.showNotification("Avatar updated successfully!","success")},t.readAsDataURL(e)}}}const E=new S;window.SettingsManager=S,window.settingsManager=E,window.toggleDarkModeSetting=()=>E.toggleDarkMode(),window.toggleNotifications=()=>E.toggleNotifications(),window.toggleAutoSave=()=>E.toggleAutoSave(),window.toggleShowTips=()=>E.toggleShowTips(),window.handleAvatarUpload=t=>E.handleAvatarUpload(t);class x{constructor(){this.stats={netWorth:null,totalDebt:null,creditUtilization:null,savingsProgress:null}}async updateProfileStats(t){const e=null==t?void 0:t.currentUser;if(e){const t=document.getElementById("profileName"),n=document.getElementById("profileEmail");t&&(t.textContent=e.displayName||"User"),n&&(n.textContent=e.email||"Email")}let n=null,o=null,i=null,a=null;const r=(t=[])=>{if(!Array.isArray(t))return;const e=t.reduce((t,e)=>t+(parseFloat(e.balance)||0),0);Number.isNaN(e)||(o=e);const n=t.filter(t=>"credit"===t.type),a=n.reduce((t,e)=>t+(parseFloat(e.limit)||0),0),r=n.reduce((t,e)=>t+(parseFloat(e.balance)||0),0);a>0?i=r/a*100:null===i&&0===r&&(i=0)};try{const t=localStorage.getItem("debts");if(t&&r(JSON.parse(t)),null===o){const t=localStorage.getItem("local_test_debts");t&&r(JSON.parse(t))}const e=localStorage.getItem("netWorth");if(e){const t=JSON.parse(e);if(t&&t.history&&t.history.length>0){const e=t.history[t.history.length-1],o=parseFloat(e.netWorth);Number.isNaN(o)||(n=o)}}if(null===n){const t=localStorage.getItem("local_test_networth");if(t){const e=JSON.parse(t);if(e&&e.history&&e.history.length>0){const t=e.history[e.history.length-1],o=parseFloat(t.netWorth);Number.isNaN(o)||(n=o)}}}const c=localStorage.getItem("savingsGoals");if(c){const t=JSON.parse(c);if(Array.isArray(t)&&t.length>0){const e=t.reduce((t,e)=>t+(parseFloat(e.target)||0),0),n=t.reduce((t,e)=>t+(parseFloat(e.saved)||0),0);e>0?a=n/e*100:null===a&&(a=0)}}if(null===a){const t=localStorage.getItem("local_test_savings");if(t){const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0){const t=e.reduce((t,e)=>t+(parseFloat(e.target)||0),0),n=e.reduce((t,e)=>t+(parseFloat(e.saved)||0),0);a=t>0?n/t*100:0}}}if("function"==typeof window.getLocalTestData)try{const t=window.getLocalTestData("userStats");t&&("number"==typeof t.netWorth&&(n=t.netWorth),"number"==typeof t.totalDebt&&(o=t.totalDebt),"number"==typeof t.creditUtilization&&(i=t.creditUtilization),"number"==typeof t.savingsProgress&&(a=t.savingsProgress))}catch(s){}const d=document.getElementById("profileNetWorth"),l=document.getElementById("profileTotalDebt"),u=document.getElementById("profileCreditUtilization"),m=document.getElementById("profileSavings");d&&(d.textContent=Number.isFinite(n)?"$".concat(Math.round(n).toLocaleString()):"-"),l&&(l.textContent=Number.isFinite(o)?"$".concat(Math.round(o).toLocaleString()):"-"),u&&(u.textContent=Number.isFinite(i)?"".concat(i.toFixed(1),"%"):"-"),m&&(m.textContent=Number.isFinite(a)?"".concat(a.toFixed(1),"%"):"-"),this.stats={netWorth:n,totalDebt:o,creditUtilization:i,savingsProgress:a}}catch(c){const t={profileNetWorth:"-",profileTotalDebt:"-",profileCreditUtilization:"-",profileSavings:"-"};Object.entries(t).forEach(([t,e])=>{const n=document.getElementById(t);n&&(n.textContent=e)})}}getStats(){return{...this.stats}}}const D=new x;window.ProfileStats=x,window.profileStats=D,window.updateProfileStats=t=>D.updateProfileStats(t);class L{constructor(){this.modal=null,this.isOpen=!1}openAdvancedSettings(){let t=document.getElementById("advancedSettingsModal");if(!t){if(t=document.createElement("div"),t.id="advancedSettingsModal",t.className="modal",t.style.display="none",t.innerHTML='\n        <div class="modal-content" style="max-width: 600px;">\n          <div class="modal-header">\n            <h2>‚öôÔ∏è Advanced Settings</h2>\n            <button class="close-btn" id="closeAdvancedSettings">&times;</button>\n          </div>\n          <div class="modal-body">\n            <div class="settings-section">\n              <h3>Data Management</h3>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableAutoBackup" checked>\n                  Enable automatic data backup\n                </label>\n                <p class="setting-description">Automatically backup your data to cloud storage</p>\n              </div>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableDataSync" checked>\n                  Enable data synchronization\n                </label>\n                <p class="setting-description">Sync your data across all devices</p>\n              </div>\n            </div>\n            \n            <div class="settings-section">\n              <h3>Performance</h3>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableCaching" checked>\n                  Enable browser caching\n                </label>\n                <p class="setting-description">Cache data locally for faster loading</p>\n              </div>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableLazyLoading" checked>\n                  Enable lazy loading\n                </label>\n                <p class="setting-description">Load content as needed for better performance</p>\n              </div>\n            </div>\n            \n            <div class="settings-section">\n              <h3>Privacy & Security</h3>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableAnalytics" checked>\n                  Enable analytics\n                </label>\n                <p class="setting-description">Help us improve by sharing anonymous usage data</p>\n              </div>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableErrorReporting" checked>\n                  Enable error reporting\n                </label>\n                <p class="setting-description">Automatically report errors to help fix issues</p>\n              </div>\n            </div>\n            \n            <div class="settings-section">\n              <h3>Experimental Features</h3>\n              <div class="setting-item">\n                <label>\n                  <input type="checkbox" id="enableBetaFeatures">\n                  Enable beta features\n                </label>\n                <p class="setting-description">Try out new features before they\'re released</p>\n              </div>\n            </div>\n            \n            <div class="settings-actions">\n              <button class="btn btn-primary" id="saveAdvancedSettings">Save Settings</button>\n              <button class="btn btn-secondary" id="resetAdvancedSettings">Reset to Defaults</button>\n            </div>\n          </div>\n        </div>\n      ',document.body.appendChild(t),!document.getElementById("advancedSettingsStyles")){const t=document.createElement("style");t.id="advancedSettingsStyles",t.textContent='\n          #advancedSettingsModal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 10000;\n          }\n          #advancedSettingsModal .modal-content {\n            background: white;\n            border-radius: 12px;\n            padding: 24px;\n            max-width: 600px;\n            max-height: 80vh;\n            overflow-y: auto;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n          }\n          #advancedSettingsModal .modal-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 12px;\n            border-bottom: 1px solid #e5e7eb;\n          }\n          #advancedSettingsModal .modal-header h2 {\n            margin: 0;\n            font-size: 1.5rem;\n          }\n          #advancedSettingsModal .close-btn {\n            background: none;\n            border: none;\n            font-size: 2rem;\n            cursor: pointer;\n            color: #6b7280;\n            padding: 0;\n            width: 32px;\n            height: 32px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n          #advancedSettingsModal .close-btn:hover {\n            color: #1f2937;\n          }\n          #advancedSettingsModal .settings-section {\n            margin-bottom: 24px;\n          }\n          #advancedSettingsModal .settings-section h3 {\n            margin-bottom: 12px;\n            font-size: 1.1rem;\n            color: #374151;\n          }\n          #advancedSettingsModal .setting-item {\n            margin-bottom: 16px;\n          }\n          #advancedSettingsModal .setting-item label {\n            display: flex;\n            align-items: center;\n            cursor: pointer;\n            font-weight: 500;\n          }\n          #advancedSettingsModal .setting-item input[type="checkbox"] {\n            margin-right: 8px;\n            width: 18px;\n            height: 18px;\n            cursor: pointer;\n          }\n          #advancedSettingsModal .setting-description {\n            margin: 4px 0 0 26px;\n            font-size: 0.875rem;\n            color: #6b7280;\n          }\n          #advancedSettingsModal .settings-actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 20px;\n            border-top: 1px solid #e5e7eb;\n          }\n          #advancedSettingsModal .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 500;\n            transition: all 0.2s;\n          }\n          #advancedSettingsModal .btn-primary {\n            background: #2563eb;\n            color: white;\n          }\n          #advancedSettingsModal .btn-primary:hover {\n            background: #1d4ed8;\n          }\n          #advancedSettingsModal .btn-secondary {\n            background: #e5e7eb;\n            color: #374151;\n          }\n          #advancedSettingsModal .btn-secondary:hover {\n            background: #d1d5db;\n          }\n        ',document.head.appendChild(t)}const e=t.querySelector("#closeAdvancedSettings"),n=t.querySelector("#saveAdvancedSettings"),o=t.querySelector("#resetAdvancedSettings");e.addEventListener("click",()=>this.closeAdvancedSettings()),n.addEventListener("click",()=>this.saveAdvancedSettings()),o.addEventListener("click",()=>this.resetAdvancedSettings()),t.addEventListener("click",e=>{e.target===t&&this.closeAdvancedSettings()}),this.loadAdvancedSettings()}this.modal=t,t.style.display="flex",this.isOpen=!0,document.body.style.overflow="hidden"}closeAdvancedSettings(){this.modal&&(this.modal.style.display="none",this.isOpen=!1,document.body.style.overflow="")}loadAdvancedSettings(){if(!this.modal)return;const t={enableAutoBackup:"false"!==localStorage.getItem("advanced_autoBackup"),enableDataSync:"false"!==localStorage.getItem("advanced_dataSync"),enableCaching:"false"!==localStorage.getItem("advanced_caching"),enableLazyLoading:"false"!==localStorage.getItem("advanced_lazyLoading"),enableAnalytics:"false"!==localStorage.getItem("advanced_analytics"),enableErrorReporting:"false"!==localStorage.getItem("advanced_errorReporting"),enableBetaFeatures:"true"===localStorage.getItem("advanced_betaFeatures")};Object.entries(t).forEach(([t,e])=>{const n=this.modal.querySelector("#".concat(t));n&&(n.checked=e)})}saveAdvancedSettings(){if(!this.modal)return;const t={autoBackup:this.modal.querySelector("#enableAutoBackup").checked,dataSync:this.modal.querySelector("#enableDataSync").checked,caching:this.modal.querySelector("#enableCaching").checked,lazyLoading:this.modal.querySelector("#enableLazyLoading").checked,analytics:this.modal.querySelector("#enableAnalytics").checked,errorReporting:this.modal.querySelector("#enableErrorReporting").checked,betaFeatures:this.modal.querySelector("#enableBetaFeatures").checked};Object.entries(t).forEach(([t,e])=>{localStorage.setItem("advanced_".concat(t),e.toString())}),"function"==typeof window.showNotification&&window.showNotification("Advanced settings saved successfully!","success"),this.closeAdvancedSettings()}resetAdvancedSettings(){if(this.modal&&confirm("Are you sure you want to reset all advanced settings to defaults?")){["autoBackup","dataSync","caching","lazyLoading","analytics","errorReporting","betaFeatures"].forEach(t=>{localStorage.removeItem("advanced_".concat(t))}),this.loadAdvancedSettings(),"function"==typeof window.showNotification&&window.showNotification("Advanced settings reset to defaults","info")}}}const I=new L;window.AdvancedSettings=L,window.advancedSettings=I,window.openAdvancedSettings=()=>I.openAdvancedSettings();class T{constructor(){this.notifications=[],this.container=null,this.maxNotifications=5,this.defaultDuration=3e3}init(){if(!this.container&&(this.container=document.createElement("div"),this.container.id="notificationContainer",this.container.className="notification-container",document.body.appendChild(this.container),!document.getElementById("notificationSystemStyles"))){const t=document.createElement("style");t.id="notificationSystemStyles",t.textContent="\n          .notification-container {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 10000;\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n            max-width: 400px;\n            pointer-events: none;\n          }\n          .notification {\n            background: white;\n            border-radius: 8px;\n            padding: 16px 20px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            pointer-events: auto;\n            animation: slideIn 0.3s ease-out;\n            border-left: 4px solid #2563eb;\n          }\n          .notification.success {\n            border-left-color: #22c55e;\n          }\n          .notification.error {\n            border-left-color: #ef4444;\n          }\n          .notification.warning {\n            border-left-color: #f59e0b;\n          }\n          .notification.info {\n            border-left-color: #3b82f6;\n          }\n          .notification-icon {\n            font-size: 1.5rem;\n            flex-shrink: 0;\n          }\n          .notification-content {\n            flex: 1;\n          }\n          .notification-message {\n            margin: 0;\n            font-size: 0.875rem;\n            color: #1f2937;\n            font-weight: 500;\n          }\n          .notification-close {\n            background: none;\n            border: none;\n            font-size: 1.25rem;\n            cursor: pointer;\n            color: #6b7280;\n            padding: 0;\n            width: 24px;\n            height: 24px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0;\n          }\n          .notification-close:hover {\n            color: #1f2937;\n          }\n          @keyframes slideIn {\n            from {\n              transform: translateX(100%);\n              opacity: 0;\n            }\n            to {\n              transform: translateX(0);\n              opacity: 1;\n            }\n          }\n          @keyframes slideOut {\n            from {\n              transform: translateX(0);\n              opacity: 1;\n            }\n            to {\n              transform: translateX(100%);\n              opacity: 0;\n            }\n          }\n          .notification.removing {\n            animation: slideOut 0.3s ease-in forwards;\n          }\n        ",document.head.appendChild(t)}}show(t,e="info",n=this.defaultDuration){if(this.container||this.init(),this.notifications.length>=this.maxNotifications){const t=this.notifications.shift();this.remove(t.id)}const o=document.createElement("div"),i="notification-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));o.id=i,o.className="notification ".concat(e);const a={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};return o.innerHTML='\n      <span class="notification-icon">'.concat(a[e]||a.info,'</span>\n      <div class="notification-content">\n        <p class="notification-message">').concat(this.escapeHtml(t),'</p>\n      </div>\n      <button class="notification-close" onclick="window.notificationSystem.remove(\'').concat(i,"')\">&times;</button>\n    "),this.container.appendChild(o),this.notifications.push({id:i,element:o,duration:n}),n>0&&setTimeout(()=>{this.remove(i)},n),i}remove(t){const e=this.notifications.find(e=>e.id===t);e&&(e.element.classList.add("removing"),setTimeout(()=>{e.element.parentNode&&e.element.parentNode.removeChild(e.element),this.notifications=this.notifications.filter(e=>e.id!==t)},300))}clear(){this.notifications.forEach(t=>{this.remove(t.id)})}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}success(t,e=this.defaultDuration){return this.show(t,"success",e)}error(t,e=this.defaultDuration){return this.show(t,"error",e)}warning(t,e=this.defaultDuration){return this.show(t,"warning",e)}info(t,e=this.defaultDuration){return this.show(t,"info",e)}}const A=new T;window.NotificationSystem=T,window.notificationSystem=A,window.showNotification=(t,e,n)=>A.show(t,e,n),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>A.init()):A.init();class k{constructor(t,e){this.auth=t,this.db=e,this.stats={creditUtilization:null,netWorth:null,totalDebt:null,savingsProgress:null}}isTestUser(t){var e,n;if(!t||!t.email)return!1;return((null==(n=null==(e=window.CONFIG)?void 0:e.security)?void 0:n.allowUnverifiedAccounts)||[]).map(t=>t.toLowerCase()).includes(t.email.toLowerCase())}async loadDashboardData(t){if(!this.auth||!this.db)return;const n=this.auth.currentUser;if(n)if(t)try{let t,a,r,s;try{const n=await e(()=>import("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"),[]);t=n.doc,a=n.getDoc,r=n.setDoc,s=n.onSnapshot}catch(o){throw new Error("Firestore functions not available")}const c=t(this.db,"users",n.uid);try{const t=await a(c),e=this.isTestUser(n);if(t.exists()){const o=t.data(),i=!(o.creditUtilization&&0!==o.creditUtilization||o.netWorth&&0!==o.netWorth||o.totalDebt&&0!==o.totalDebt||o.sampleDataInitialized);if(i&&e){await this.initializeSampleData(n);const t=await a(c);if(t.exists()){const e=t.data();this.updateStatsFromData(e)}}else i&&!e||this.updateStatsFromData(o)}else e?await this.initializeSampleData(n):await r(c,{email:n.email,displayName:n.displayName||"",joined:(new Date).toISOString(),lastLogin:(new Date).toISOString(),creditUtilization:0,netWorth:0,totalDebt:0,savingsProgress:0},{merge:!0})}catch(i){this.isTestUser(n)?this.applyLocalDashboardData():this.setDefaultValues()}try{const t=s(c,t=>{try{if(!t.exists())return void(this.isTestUser(n)?this.initializeSampleData(n):this.setDefaultValues());const e=t.data()||{};if(!(e.creditUtilization&&0!==e.creditUtilization||e.netWorth&&0!==e.netWorth||e.totalDebt&&0!==e.totalDebt||e.sampleDataInitialized)&&this.isTestUser(n))return void this.initializeSampleData(n).then(()=>{var t;let e={creditUtilization:37.5,netWorth:54200,totalDebt:23300,savingsProgress:44};if("function"==typeof window.getLocalTestData){const t=window.getLocalTestData("userStats");t&&(e=t)}else(null==(t=window.LOCAL_TEST_DATA)?void 0:t.userStats)&&Object.assign(e,window.LOCAL_TEST_DATA.userStats);this.updateStatsFromData(e)});this.updateStatsFromData(e)}catch(i){}},t=>{this.isTestUser(n)?this.applyLocalDashboardData():this.setDefaultValues()});"undefined"!=typeof window&&(window._dashboardUnsubscribe=t)}catch(i){this.isTestUser(n)?this.applyLocalDashboardData():this.setDefaultValues()}}catch(i){window.ErrorHandler&&window.ErrorHandler.handleFirebaseError(i),this.isTestUser(n)?this.applyLocalDashboardData():this.setDefaultValues()}else this.isTestUser(n)?this.applyLocalDashboardData():this.setDefaultValues();else"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||this.applyLocalDashboardData()}updateStatsFromData(t){const e=t.creditUtilization,n=document.getElementById("creditUtilizationValue");n&&(void 0===e||isNaN(e)?(n.textContent="No data yet",n.style.color="#64748b"):(n.textContent="".concat(Number(e).toFixed(1),"%"),n.style.color=e<30?"#22c55e":e<50?"#f59e42":"#ef4444",this.stats.creditUtilization=e));const o=t.netWorth,i=document.getElementById("netWorthValue");if(i)if(void 0===o||isNaN(o))i.textContent="No data yet",i.style.color="#64748b";else{const t=Number(o).toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0});i.textContent=t,i.style.color=o>=0?"#22c55e":"#ef4444",this.stats.netWorth=o}const a=t.totalDebt,r=document.getElementById("debtSummaryValue");if(r)if(void 0===a||isNaN(a))r.textContent="No data yet",r.style.color="#64748b";else{const t=Number(a).toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0});r.textContent=t,r.style.color=a>0?"#ef4444":"#22c55e",this.stats.totalDebt=a}const s=t.savingsProgress,c=document.getElementById("savingsValue");c&&(void 0===s||isNaN(s)?(c.textContent="No data yet",c.style.color="#64748b"):(c.textContent="".concat(Number(s).toFixed(1),"% of goals"),c.style.color=s>=100?"#22c55e":s>=50?"#f59e42":"#ef4444",this.stats.savingsProgress=s))}setDefaultValues(){["creditUtilizationValue","netWorthValue","debtSummaryValue","savingsValue"].forEach(t=>{const e=document.getElementById(t);e&&(e.textContent="No data yet",e.style.color="#64748b")})}applyLocalDashboardData(){var t;let e=null;if("function"==typeof window.getLocalTestData?e=window.getLocalTestData("userStats"):(null==(t=window.LOCAL_TEST_DATA)?void 0:t.userStats)&&(e=window.LOCAL_TEST_DATA.userStats),e)this.updateStatsFromData(e);else{const t={creditUtilization:37.5,netWorth:54200,totalDebt:23300,savingsProgress:44};this.updateStatsFromData(t)}}async initializeSampleData(t){var n;if(t&&this.db&&this.isTestUser(t))try{const{doc:o,getDoc:i,setDoc:a,onSnapshot:r}=await e(async()=>{const{doc:t,getDoc:e,setDoc:n,onSnapshot:o}=await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js");return{doc:t,getDoc:e,setDoc:n,onSnapshot:o}},[]),s=o(this.db,"users",t.uid),c=await i(s);if(!c.exists()||0===c.data().creditUtilization&&0===c.data().netWorth&&0===c.data().totalDebt){let e={creditUtilization:37.5,netWorth:54200,totalDebt:23300,savingsProgress:44};if("function"==typeof window.getLocalTestData){const t=window.getLocalTestData("userStats");t&&(e=t)}else(null==(n=window.LOCAL_TEST_DATA)?void 0:n.userStats)&&(e=window.LOCAL_TEST_DATA.userStats);await a(s,{email:t.email,displayName:t.displayName||"",joined:(new Date).toISOString(),lastLogin:(new Date).toISOString(),creditUtilization:e.creditUtilization||0,netWorth:e.netWorth||0,totalDebt:e.totalDebt||0,savingsProgress:e.savingsProgress||0,sampleDataInitialized:!0},{merge:!0}),this.updateStatsFromData(e),setTimeout(()=>{this.updateStatsFromData(e)},100)}}catch(o){}}getStats(){return{...this.stats}}}async function N(){const t={};try{const e=localStorage.getItem("debts");e&&(t.debts=JSON.parse(e));const n=localStorage.getItem("budgets");n&&(t.budgets=JSON.parse(n));const o=localStorage.getItem("savingsGoals");o&&(t.savingsGoals=JSON.parse(o));const i=localStorage.getItem("netWorth");i&&(t.netWorth=JSON.parse(i));const a=localStorage.getItem("velocityCalculations");a&&(t.velocityCalculations=JSON.parse(a));const r=localStorage.getItem("taxCalculations");r&&(t.taxCalculations=JSON.parse(r));const s=localStorage.getItem("activityLogs");s&&(t.activityLogs=JSON.parse(s))}catch(e){}return t}function C(t){if(!t||"object"!=typeof t)throw new Error("Invalid financial data: data must be an object");const e=Array.isArray(t.debts)?t.debts:[],n=Array.isArray(t.savings)?t.savings:[],o=Array.isArray(t.assets)?t.assets:[],i=Array.isArray(t.income)?t.income:[],a=e.reduce((t,e)=>{const n="number"!=typeof e.balance||isNaN(e.balance)?0:e.balance;return t+Math.max(0,n)},0),r=n.reduce((t,e)=>{const n="number"!=typeof e.balance||isNaN(e.balance)?0:e.balance;return t+Math.max(0,n)},0),s=o.reduce((t,e)=>{const n="number"!=typeof e.value||isNaN(e.value)?0:e.value;return t+Math.max(0,n)},0),c=i.reduce((t,e)=>{const n="number"!=typeof e.amount||isNaN(e.amount)?0:e.amount;return t+Math.max(0,n)},0),d=e.filter(t=>"credit_card"===t.type||t.creditLimit),l=d.reduce((t,e)=>{const n="number"!=typeof e.balance||isNaN(e.balance)?0:e.balance;return t+Math.max(0,n)},0),u=d.reduce((t,e)=>{const n="number"!=typeof e.creditLimit||isNaN(e.creditLimit)?0:e.creditLimit;return t+Math.max(0,n)},0),m=u>0?l/u*100:0,p=s+r-a,h=c>0?a/c*100:a>0?1/0:0,g=[];return m>30&&g.push("Your credit utilization is above the recommended 30%. Consider paying down credit card balances."),h>36&&g.push("Your debt-to-income ratio is high. Focus on reducing debt or increasing income."),p<0&&g.push("Your net worth is negative. Create a plan to reduce debt and build savings."),0===r&&a>0&&g.push("Consider building an emergency fund while paying down debt."),{metrics:{totalDebt:Math.round(100*a)/100,totalSavings:Math.round(100*r)/100,totalAssets:Math.round(100*s)/100,totalIncome:Math.round(100*c)/100,netWorth:Math.round(100*p)/100,creditUtilization:Math.round(100*m)/100,debtToIncomeRatio:Math.round(100*h)/100},recommendations:g}}let F,_,M,j,z,U;(async()=>{try{let t=0;for(;(!window.auth||!window.db)&&t<50;)await new Promise(t=>setTimeout(t,100)),t++;window.auth&&window.db&&(F=window.auth,_=window.db,M=window.logout,j=window.extendSession,z=window.login,U=window.register)}catch(t){}})();let O=null;function B(){["creditUtilizationValue","netWorthValue","debtSummaryValue","savingsValue"].forEach(t=>{const e=document.getElementById(t);e&&(e.textContent="No data yet",e.style.color="#64748b")})}async function P(){const t=F||window.auth,e=_||window.db;if(!t||!e)return await new Promise(t=>setTimeout(t,500)),P();if(!t.currentUser){let e=!1;return t.onAuthStateChanged(t=>{t&&!e?(e=!0,setTimeout(()=>{R()},500)):t||(B(),e=!1)}),void B()}await R()}async function R(){if(!k)return;const t=F||window.auth,e=_||window.db;if(t&&e)try{O=new k(t,e);const n="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,o="undefined"!=typeof USE_FIRESTORE?USE_FIRESTORE:!n;if(r&&"function"==typeof r.wrapAsync){const t=r.wrapAsync(()=>O.loadDashboardData(o),"dashboard_data_load");await t()}else await O.loadDashboardData(o);c&&"function"==typeof c.info&&c.info("Dashboard data initialized successfully")}catch(n){c&&"function"==typeof c.error&&c.error("Failed to initialize dashboard data",{error:n.message}),r&&"function"==typeof r.handleError&&r.handleError(n,{context:"dashboard_initialization"})}}async function W(){try{if("function"==typeof waitForAuth){const{auth:t,db:e}=await waitForAuth(1e4);window.auth=t,window.db=e,F||(F=t),_||(_=e)}else{let t=0;const e=50;for(;!F&&!window.auth||!_&&!window.db;){if(t>=e)return void B();await new Promise(t=>setTimeout(t,100)),t++}}window.auth||(window.auth=F),window.db||(window.db=_),await new Promise(t=>setTimeout(t,300));const t=F||window.auth,e=!!(null==t?void 0:t.currentUser);P().catch(t=>{}),e||setTimeout(()=>{const t=F||window.auth;(null==t?void 0:t.currentUser)&&R()},1e3)}catch(t){B()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",W):W();const V=document.getElementById("profileButton"),q=document.getElementById("profileModal"),H=document.getElementById("closeProfileModal");function J(){if(!q)return c&&c.error("Profile modal not found"),void(r&&r.handleError(new Error("Profile modal not found"),{context:"profile_modal"}));q.style.display="flex",c&&c.debug("Modal display set to flex"),D&&D.updateProfileStats(F),K(),setTimeout(()=>{c&&c.debug("Avatar elements check",{container:!!document.querySelector(".avatar-container"),uploadButton:!!document.querySelector(".avatar-upload-btn"),modalVisible:q.style.display,computedStyle:window.getComputedStyle(q).display})},100)}function K(){if(void 0===window.themeManager)return void(c&&c.warn("ThemeManager not available"));const t=document.getElementById("themeDropdownButton"),e=document.getElementById("themeDropdownMenu");if(!t||!e)return void(c&&c.warn("Theme selector elements not found"));const n=window.themeManager.getAvailableThemes?window.themeManager.getAvailableThemes():["blue","pink","green","purple","orange","teal","red","auto"],o={blue:{name:"Blue",color:"#007bff",icon:"üîµ"},pink:{name:"Pink",color:"#ff4b91",icon:"ü©∑"},green:{name:"Green",color:"#28a745",icon:"üü¢"},purple:{name:"Purple",color:"#6f42c1",icon:"üü£"},orange:{name:"Orange",color:"#fd7e14",icon:"üü†"},teal:{name:"Teal",color:"#20c997",icon:"üî∑"},red:{name:"Red",color:"#dc3545",icon:"üî¥"},auto:{name:"Auto",color:"#64748b",icon:"‚öôÔ∏è"}};e.innerHTML=n.map(t=>{const e=o[t]||{name:t,color:"#007bff"};return'\n      <div class="theme-option" data-theme="'.concat(t,'">\n        <div class="theme-swatch" style="background: ').concat(e.color,'"></div>\n        <span>').concat(e.name,"</span>\n      </div>\n    ")}).join(""),e.querySelectorAll(".theme-option").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.theme;window.themeManager.setTheme(e),$()})}),$()}function $(){if(void 0===window.themeManager)return;const t=window.themeManager.getCurrentTheme?window.themeManager.getCurrentTheme():"blue",e=document.getElementById("themeDropdownMenu");e&&e.querySelectorAll(".theme-option").forEach(e=>{e.dataset.theme===t?e.classList.add("active"):e.classList.remove("active")})}if(c&&(c.debug("Profile button found",{exists:!!V}),c.debug("Profile modal found",{exists:!!q})),V?V.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),c&&c.debug("Profile button clicked, opening modal"),J()}):(c&&c.error("Profile button not found"),r&&r.handleError(new Error("Profile button not found"),{context:"profile_button"})),window.addEventListener("profile-modal-open",()=>{c&&c.debug("Profile modal open event received"),J()}),H&&H.addEventListener("click",()=>{q&&(q.style.display="none")}),window.addEventListener("click",t=>{t.target===q&&q&&(q.style.display="none")}),E){E.loadSettings();const t=document.getElementById("settingsDarkMode");t&&t.addEventListener("change",()=>E.toggleDarkMode());const e=document.getElementById("settingsNotifications");e&&e.addEventListener("change",()=>E.toggleNotifications());const n=document.getElementById("settingsAutoSave");n&&n.addEventListener("change",()=>E.toggleAutoSave());const o=document.getElementById("settingsShowTips");o&&o.addEventListener("change",()=>E.toggleShowTips());const i=document.getElementById("avatarUpload");i&&i.addEventListener("change",t=>E.handleAvatarUpload(t))}const G=document.getElementById("advancedSettingsBtn");if(G&&I&&G.addEventListener("click",()=>{I.openAdvancedSettings()}),b){const t=[{category:"Debt Management",title:"Pay High-Interest Debt First",content:"Focus on paying off debts with the highest interest rates first to save money over time."},{category:"Savings",title:"Build an Emergency Fund",content:"Aim to save 3-6 months of expenses in an emergency fund for unexpected situations."},{category:"Budgeting",title:"Track Every Expense",content:"Keep track of all your expenses to understand where your money is going."},{category:"Credit",title:"Keep Credit Utilization Low",content:"Try to keep your credit card balances below 30% of your credit limits."}];b.init(t);const e=document.getElementById("nextTip"),n=document.getElementById("previousTip");e&&e.addEventListener("click",()=>b.nextTip()),n&&n.addEventListener("click",()=>b.previousTip())}async function Y(t){if(!y)return c&&c.error("DataExport component not available"),void(r&&r.handleError(new Error("DataExport component not available"),{context:"data_export"}));if(!["json","csv","pdf"].includes(t))return c&&c.error("Invalid export format",{format:t}),void(r&&r.handleError(new Error("Invalid export format: ".concat(t)),{context:"data_export"}));const e=A?(t,e)=>A.show(t,e):(t,e)=>{};await y.exportAllData(t,e,N,C)}const X=document.getElementById("exportJSON"),Z=document.getElementById("exportCSV"),Q=document.getElementById("exportPDF");async function tt(){if(w)try{if(m){if(!m.check("financial_insights_update",{window:6e4,max:10}).allowed)return void(c&&c.warn("Rate limit exceeded for financial insights update"))}const t=C(await N()),e=[];t.metrics.totalDebt>0&&e.push({title:"Debt Overview",data:{totalDebt:t.metrics.totalDebt,creditUtilization:t.metrics.creditUtilization}}),null!==t.metrics.netWorth&&e.push({title:"Net Worth",data:{current:t.metrics.netWorth,change:t.metrics.netWorthChange}});const n=document.getElementById("financialInsights");n&&w.renderInsights(e,n);const o=[];t.metrics.creditUtilization>30&&o.push({title:"Reduce Credit Utilization",description:"Your credit utilization is above the recommended 30%.",action:"Pay down credit card balances to improve your credit score.",priority:1}),t.metrics.totalDebt>0&&t.metrics.netWorth<0&&o.push({title:"Focus on Debt Reduction",description:"Your net worth is negative due to debt.",action:"Create a debt payoff plan and stick to it.",priority:1});const i=document.getElementById("recommendationsContainer");i&&w.renderRecommendations(o,i)}catch(t){c&&c.error("Error updating financial insights",{error:t.message,stack:t.stack}),r&&r.handleError(t,{context:"financial_insights_update"})}else c&&c.warn("FinancialInsights component not available")}if(X&&X.addEventListener("click",()=>Y("json")),Z&&Z.addEventListener("click",()=>Y("csv")),Q&&Q.addEventListener("click",()=>Y("pdf")),F){const t=()=>{F.currentUser&&setTimeout(tt,1e3)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):setTimeout(t,2e3)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{tt()}):tt(),window.openProfileModal=()=>{J()},window.updateProfileStats=()=>{D&&D.updateProfileStats(F)},window.initializeThemeSelector=K,window.updateThemeSelector=$,window.handleExport=Y,window.updateFinancialInsights=tt;export{t as __vite_legacy_guard};
