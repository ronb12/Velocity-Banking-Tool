function t(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}import"./modulepreload-polyfill-YP0FEG5d.js";import"./auth-D-ZYIE7C.js";/* empty css              */import{Timestamp as e,deleteDoc as n,doc as i,query as a,collection as o,orderBy as s,getDocs as c}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";let d,l=[],r=null;const y=["localhost","127.0.0.1"].includes(window.location.hostname);function p(){var t;try{const t=localStorage.getItem("local_test_activity");if(t)return JSON.parse(t)}catch(i){}const e=window.getLocalTestData&&window.getLocalTestData("activityLogs")||(null==(t=window.LOCAL_TEST_DATA)?void 0:t.activityLogs)||[];return n=e,JSON.parse(JSON.stringify(n));var n}function m(t=!1){const e=document.getElementById("activityFeed"),n=document.getElementById("loading"),i=p();if(n.style.display="none",l=i.map(t=>({...t})),u(),!l.length)return void(e.innerHTML='\n          <div class="empty-state">\n            <div style="font-size: 4em; margin-bottom: 20px;">üìù</div>\n            <h3>No activities yet</h3>\n            <p>Start using the financial tools to see your activity feed here!</p>\n          </div>\n        ');let a="";l.forEach((e,n)=>{const i=t&&n<3,o=v(e.type),s=g(e.timestamp);a+='\n          <div class="entry '.concat(i?"new":"",'">\n            <div class="entry-left">\n              <div class="entry-icon">').concat(e.icon||"üìù",'</div>\n              <div>\n                <div class="entry-text">').concat(e.text||"Activity logged","</div>\n                ").concat(e.type?'<span class="entry-type '.concat(o,'">').concat(e.type.replace("_"," "),"</span>"):"",'\n              </div>\n            </div>\n            <div class="entry-time">').concat(s,"</div>\n          </div>\n        ")}),e.innerHTML=a,r=new Date}function v(t){return{debt_payment:"type-debt",debt_added:"type-debt",debt_updated:"type-debt",debt_deleted:"type-debt",budget_created:"type-budget",budget_updated:"type-budget",budget_spent:"type-budget",savings_goal_created:"type-savings",savings_goal_updated:"type-savings",savings_goal_completed:"type-savings",savings_contribution:"type-savings",net_worth_updated:"type-networth",velocity_calculated:"type-velocity",tax_calculated:"type-tax",login:"type-login",logout:"type-login"}[t]||"type-login"}function g(t){if(!t)return"Just now";const e=new Date,n=t.seconds?new Date(1e3*t.seconds):new Date(t),i=e-n,a=Math.floor(i/6e4),o=Math.floor(a/60),s=Math.floor(o/24);return a<1?"Just now":a<60?"".concat(a,"m ago"):o<24?"".concat(o,"h ago"):s<7?"".concat(s,"d ago"):n.toLocaleDateString()}function u(){const t=l.length,e=l.filter(t=>t.type&&t.type.startsWith("debt")).length,n=l.filter(t=>t.type&&t.type.startsWith("savings")).length,i=new Date((new Date).getTime()-864e5),a=l.filter(t=>{var e;return((null==(e=t.timestamp)?void 0:e.seconds)?new Date(1e3*t.timestamp.seconds):new Date(t.timestamp))>i}).length;document.getElementById("totalActivities").textContent=t,document.getElementById("debtActivities").textContent=e,document.getElementById("savingsActivities").textContent=n,document.getElementById("recentActivities").textContent=a}async function h(t,e=!1){const n=document.getElementById("activityFeed"),i=document.getElementById("loading");if(i.style.display="block",y)m(e);else try{const d=a(o(db,"users",t.uid,"activity_logs"),s("timestamp","desc")),y=await c(d);if(i.style.display="none",l=[],y.forEach(t=>{l.push({id:t.id,...t.data()})}),u(),0===l.length)return void(n.innerHTML='\n            <div class="empty-state">\n              <div style="font-size: 4em; margin-bottom: 20px;">üìù</div>\n              <h3>No activities yet</h3>\n              <p>Start using the financial tools to see your activity feed here!</p>\n            </div>\n          ');let p="";l.forEach((t,n)=>{const i=e&&n<3,a=v(t.type),o=g(t.timestamp);p+='\n            <div class="entry '.concat(i?"new":"",'">\n              <div class="entry-left">\n                <div class="entry-icon">').concat(t.icon||"üìù",'</div>\n                <div>\n                  <div class="entry-text">').concat(t.text||"Activity logged","</div>\n                  ").concat(t.type?'<span class="entry-type '.concat(a,'">').concat(t.type.replace("_"," "),"</span>"):"",'\n                </div>\n              </div>\n              <div class="entry-time">').concat(o,"</div>\n            </div>\n          ")}),n.innerHTML=p,r=new Date}catch(d){i.style.display="none",n.innerHTML='\n          <div class="empty-state">\n            <div style="font-size: 4em; margin-bottom: 20px;">‚ùå</div>\n            <h3>Error loading activities</h3>\n            <p>Please try refreshing the page.</p>\n          </div>\n        '}}function f(){d=y?setInterval(()=>{m(!0)},3e4):setInterval(()=>{const t=auth.currentUser;t&&h(t,!0)},3e4)}function w(){d&&clearInterval(d)}window.refreshFeed=()=>{const t=auth.currentUser;t&&!y?h(t,!0):y&&m(!0)},window.clearOldActivities=async()=>{const t=auth.currentUser;if((t||y)&&confirm("Clear activities older than 30 days? This action cannot be undone.")){if(y){const t=new Date;t.setDate(t.getDate()-30);const e=p().filter(e=>{var n;return((null==(n=e.timestamp)?void 0:n.seconds)?new Date(1e3*e.timestamp.seconds):new Date(e.timestamp||Date.now()))>=t});return function(t){try{localStorage.setItem("local_test_activity",JSON.stringify(t))}catch(e){}}(e),alert("Cleared ".concat(l.length-e.length," old activities")),void m()}try{const a=new Date;a.setDate(a.getDate()-30);e.fromDate(a);const o=l.filter(t=>{var e;return((null==(e=t.timestamp)?void 0:e.seconds)?new Date(1e3*t.timestamp.seconds):new Date(t.timestamp))<a}),s=o.map(e=>n(i(db,"users",t.uid,"activity_logs",e.id)));await Promise.all(s),alert("Cleared ".concat(o.length," old activities")),h(t)}catch(a){alert("Error clearing old activities")}}},(async()=>{try{const{auth:t}=await waitForAuth(1e4);window.auth=t,t.onAuthStateChanged(t=>{t?(h(t),f()):y?(m(),f()):(document.getElementById("activityFeed").innerHTML='\n              <div class="empty-state">\n                <div style="font-size: 4em; margin-bottom: 20px;">üîê</div>\n                <h3>Please log in</h3>\n                <p>You need to be logged in to view your activity feed.</p>\n                <a href="/src/pages/auth/login.html" class="btn btn-primary" style="margin-top: 20px;">Login</a>\n              </div>\n            ',document.getElementById("loading").style.display="none",w())})}catch(t){y?(m(),f()):(document.getElementById("activityFeed").innerHTML='\n            <div class="empty-state">\n              <div style="font-size: 4em; margin-bottom: 20px;">üîê</div>\n              <h3>Please log in</h3>\n              <p>You need to be logged in to view your activity feed.</p>\n              <a href="/src/pages/auth/login.html" class="btn btn-primary" style="margin-top: 20px;">Login</a>\n            </div>\n          ',document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),w())}})(),window.addEventListener("beforeunload",w);export{t as __vite_legacy_guard};
